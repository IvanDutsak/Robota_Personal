<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Warehouse Stats">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–æ–±–æ—Ç–∏ —Å–∫–ª–∞–¥-–º–∞–≥–∞–∑–∏–Ω</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="theme-switcher.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap');

        :root {
            /* Dark Theme (Default) */
            --bg-gradient: radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
                radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
                radial-gradient(at 100% 0%, hsla(339, 49%, 30%, 1) 0, transparent 50%);
            --bg-color: #0f172a;
            --glass-bg: rgba(17, 25, 40, 0.75);
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --card-hover-bg: rgba(23, 32, 50, 0.85);
            --input-bg: rgba(0, 0, 0, 0.3);
            --input-border: rgba(255, 255, 255, 0.1);
            --input-focus-bg: rgba(0, 0, 0, 0.5);
            --header-glow: linear-gradient(to right, #60a5fa, #a78bfa);
            --accent-blue: #3b82f6;
        }

        :root.light {
            /* Light Theme - Soft & Professional */
            --bg-gradient: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            --bg-color: #f8fafc;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: 1px solid rgba(203, 213, 225, 0.6);
            --glass-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --card-hover-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: rgba(148, 163, 184, 0.5);
            --input-focus-bg: #ffffff;
            --header-glow: linear-gradient(to right, #3b82f6, #6366f1);
            --accent-blue: #2563eb;
        }

        * {
            font-family: 'Outfit', sans-serif;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-color);
            background-image: var(--bg-gradient);
            background-attachment: fixed;
            background-size: cover;
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* Ambient Background Animation */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 15% 50%, rgba(76, 29, 149, 0.15), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(59, 130, 246, 0.15), transparent 25%);
            z-index: -1;
            animation: ambientPulse 10s ease-in-out infinite alternate;
            pointer-events: none;
        }

        @keyframes ambientPulse {
            0% {
                opacity: 0.5;
                transform: scale(1);
            }

            100% {
                opacity: 0.8;
                transform: scale(1.1);
            }
        }

        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: var(--glass-border);
            box-shadow: var(--glass-shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-effect:hover {
            background: var(--card-hover-bg);
            border-color: var(--glass-border);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .input-glow {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-primary);
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .input-glow:focus {
            background: var(--input-focus-bg);
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.05);
            outline: none;
        }

        .stat-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            background: var(--glass-bg);
            border: var(--glass-border);
            border-radius: 1rem;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            background: var(--card-hover-bg);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .header-glow {
            background: var(--header-glow);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.3));
        }

        /* Input styling */
        input,
        select {
            background: var(--input-bg) !important;
            border: 1px solid var(--input-border) !important;
            color: var(--text-primary) !important;
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus {
            background: var(--input-focus-bg) !important;
            border-color: var(--accent-blue) !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2) !important;
            outline: none;
        }

        /* Tariff Toggle Styles */
        .tariff-toggle {
            display: flex;
            background: var(--glass-bg);
            border: var(--glass-border);
            border-radius: 0.75rem;
            padding: 4px;
            gap: 4px;
        }

        .tariff-btn {
            flex: 1;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            background: transparent;
            color: var(--text-secondary);
        }

        .tariff-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.4);
        }

        .tariff-btn:hover:not(.active) {
            background: rgba(59, 130, 246, 0.1);
            color: var(--text-primary);
        }

        /* Multiplier text - prevent line break */
        .multiplier {
            white-space: nowrap;
            min-width: max-content;
        }

        :root.light .tariff-btn {
            color: #64748b;
        }

        :root.light .tariff-btn.active {
            color: white;
        }

        /* Hourly Rate Card */
        .hourly-rate-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .hourly-rate-card:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.15) 100%);
        }

        :root.light .hourly-rate-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(5, 150, 105, 0.08) 100%);
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: var(--glass-bg);
            border: var(--glass-border);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--glass-shadow);
        }

        .theme-toggle:hover {
            transform: rotate(15deg) scale(1.1);
            background: var(--card-hover-bg);
        }

        /* Bonus Indicator Badge */
        .bonus-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            box-shadow: 0 2px 10px rgba(16, 185, 129, 0.4);
            animation: badgePop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 10;
        }

        @keyframes badgePop {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Text Colors for Light Mode - Soft & Readable */
        :root.light .text-white {
            color: #1e293b !important;
        }

        /* Slate 800 */
        :root.light .text-blue-200 {
            color: #475569 !important;
        }

        /* Slate 600 */
        :root.light .text-blue-300 {
            color: #334155 !important;
        }

        /* Slate 700 */
        :root.light .text-blue-400 {
            color: #2563eb !important;
        }

        /* Blue 600 */
        :root.light .text-gray-400 {
            color: #64748b !important;
        }

        /* Slate 500 */
        :root.light .text-yellow-300 {
            color: #d97706 !important;
        }

        /* Amber 600 - readable warning */
        :root.light .text-green-400 {
            color: #059669 !important;
        }

        /* Emerald 600 */
        :root.light .text-pink-400 {
            color: #db2777 !important;
        }

        /* Pink 600 */

        /* Button colors in light mode */
        :root.light .btn-success {
            background: linear-gradient(135deg, #10b981, #059669) !important;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.2);
        }

        :root.light .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626) !important;
            box-shadow: 0 4px 6px -1px rgba(239, 68, 68, 0.2);
        }

        :root.light .btn-purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;
            box-shadow: 0 4px 6px -1px rgba(139, 92, 246, 0.2);
        }

        /* Result display in light mode */
        :root.light .result-display {
            background: #f1f5f9 !important;
            border: 1px solid #cbd5e1 !important;
            color: #0f172a !important;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* Total result in light mode */
        :root.light .total-result {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9) !important;
            border: 1px solid #cbd5e1 !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        :root.light .total-result::before {
            background: none !important;
            /* Remove pulse in light mode for calmness */
        }

        :root.light .total-result span {
            color: #2563eb !important;
            /* Professional Blue */
        }

        /* Icon Boxes in Light Mode */
        :root.light .icon-box.bg-blue-500\/20 {
            background-color: rgba(59, 130, 246, 0.1) !important;
        }

        :root.light .icon-box.bg-green-500\/20 {
            background-color: rgba(16, 185, 129, 0.1) !important;
        }

        :root.light .icon-box.bg-purple-500\/20 {
            background-color: rgba(139, 92, 246, 0.1) !important;
        }

        :root.light .icon-box.bg-pink-500\/20 {
            background-color: rgba(236, 72, 153, 0.1) !important;
        }

        :root.light .icon-box.bg-yellow-500\/20 {
            background-color: rgba(245, 158, 11, 0.1) !important;
        }


        /* Range Slider Styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
        }

        :root.light input[type="range"] {
            background: rgba(0, 0, 0, 0.1);
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            cursor: pointer;
            margin-top: -6px;
            transition: all 0.2s;
        }

        :root.light input[type="range"]::-webkit-slider-thumb {
            background: #3b82f6;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
        }

        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            border-radius: 3px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        :root.light ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        :root.light ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Utility for icons */
        .icon-box {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        /* Button Primary */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white !important;
        }

        /* Modal */
        .modal-content {
            background: var(--glass-bg);
            border: var(--glass-border);
            color: var(--text-primary);
        }

        /* Other buttons */
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .result-display {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #34d399;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            text-align: center;
            min-width: 100px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            font-family: 'Outfit', monospace;
            letter-spacing: 0.5px;
        }

        .total-result {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(217, 119, 6, 0.15));
            border: 1px solid rgba(245, 158, 11, 0.3);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .total-result::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 50%, rgba(245, 158, 11, 0.2), transparent 70%);
            animation: pulseGlow 3s infinite;
        }

        @keyframes pulseGlow {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        .modal-backdrop {
            backdrop-filter: blur(12px);
            background: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            animation: modalSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Light theme chart container */
        :root.light .chart-container {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(203, 213, 225, 0.6);
        }
    </style>
</head>

<body class="min-h-screen">
    <button id="theme-toggle" class="theme-toggle" aria-label="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É">
        <i class="fas fa-moon text-blue-600"></i>
    </button>
    <div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8">
        <!-- Header -->
        <div class="text-center mb-6 sm:mb-8 fade-in">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-white mb-2 sm:mb-3 header-glow">
                <i class="fas fa-warehouse mr-2 sm:mr-3 icon-rotate"></i>
                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–ª–∞–¥-–º–∞–≥–∞–∑–∏–Ω
            </h1>
            <p class="text-blue-200 text-sm sm:text-base md:text-lg">–û–±–ª—ñ–∫ —Ç–∞ –∞–Ω–∞–ª—ñ–∑ —Ä–æ–±–æ—Ç–∏</p>
        </div>

        <!-- Main Content -->
        <div class="grid lg:grid-cols-2 gap-4 sm:gap-6 md:gap-8 items-start">
            <!-- Input Section -->
            <div class="glass-effect rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 fade-in">
                <h2 class="text-xl sm:text-2xl md:text-3xl font-bold text-white mb-4 sm:mb-6 md:mb-8">
                    <i class="fas fa-calculator mr-2 sm:mr-3 text-blue-400"></i>
                    –í–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
                </h2>

                <!-- Tariff Toggle Section -->
                <div class="mb-6">
                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5">
                        <div class="flex items-center mb-3">
                            <div class="icon-box mr-3 md:mr-4 bg-amber-500/20 text-amber-400">
                                <i class="fas fa-briefcase text-lg"></i>
                            </div>
                            <span class="text-white font-semibold text-base sm:text-lg">–¢–∞—Ä–∏—Ñ–Ω–∏–π –ø–ª–∞–Ω</span>
                        </div>
                        <div class="tariff-toggle">
                            <button id="tariff-standard" class="tariff-btn active" data-tariff="standard">
                                <i class="fas fa-user-check mr-1"></i> –°—Ç–∞–Ω–¥–∞—Ä—Ç
                            </button>
                            <button id="tariff-first-month" class="tariff-btn" data-tariff="firstMonth">
                                <i class="fas fa-seedling mr-1"></i> 1-–π –º—ñ—Å—è—Ü—å
                            </button>
                        </div>
                        <div id="tariff-info" class="mt-3 text-center py-2 px-3 rounded-lg bg-white bg-opacity-10">
                            <span class="text-blue-300 text-sm">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏</span>
                        </div>
                    </div>
                </div>

                <!-- Hourly Rate Section (visible only for first month) -->
                <div id="hourly-rate-section" class="mb-6" style="display: none;">
                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5 hourly-rate-card">
                        <div class="flex items-center mb-3">
                            <div class="icon-box mr-3 md:mr-4 bg-emerald-500/20 text-emerald-400">
                                <i class="fas fa-clock text-lg"></i>
                            </div>
                            <span class="text-white font-semibold text-base sm:text-lg">–ü–æ–≥–æ–¥–∏–Ω–Ω–∞ —Å—Ç–∞–≤–∫–∞</span>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                            <div>
                                <label
                                    class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–í—ñ–¥–ø—Ä–∞—Ü—å–æ–≤–∞–Ω–æ
                                    –≥–æ–¥–∏–Ω:</label>
                                <input type="number" id="hourly-hours-worked"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-center text-base sm:text-lg font-bold"
                                    step="0.5" min="0" value="" placeholder="0" max="744">
                            </div>
                            <div>
                                <label
                                    class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–°—Ç–∞–≤–∫–∞/–≥–æ–¥:</label>
                                <div class="result-display text-base px-3 py-2 sm:px-4 sm:py-3 w-full text-center">
                                    <span class="font-bold text-emerald-400">51.04 –≥—Ä–Ω</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 bg-white bg-opacity-10 rounded-md sm:rounded-lg p-2 sm:p-3">
                            <div class="flex justify-between items-center">
                                <span class="text-blue-200 text-xs sm:text-sm">–ó–∞—Ä–æ–±—ñ—Ç–æ–∫ –∑–∞ –≥–æ–¥–∏–Ω–∏:</span>
                                <span id="hourly-earnings" class="text-emerald-400 font-bold text-lg">0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –°–µ–∫—Ü—ñ—è –ø—Ä–µ–º—ñ–π -->
                <div class="mb-6 space-y-4">
                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5 bonus-card" id="rating-card">
                        <div class="relative">
                            <div class="bonus-badge" id="rating-bonus-indicator" style="display: none;">
                                <i class="fas fa-check-circle"></i> +15%
                            </div>
                            <div class="flex items-center mb-3">
                                <div class="bg-yellow-500 p-2 sm:p-3 rounded-full mr-2 sm:mr-3 md:mr-4">
                                    <i class="fas fa-star text-white text-base sm:text-lg"></i>
                                </div>
                                <span class="text-white font-semibold text-base sm:text-lg">–°–µ—Ä–µ–¥–Ω—è –æ—Ü—ñ–Ω–∫–∞</span>
                            </div>
                            <div class="space-y-3">
                                <input type="range" id="average-rating" min="1" max="5" step="0.1" value="4.0"
                                    class="w-full">
                                <div class="flex justify-between items-center">
                                    <span class="text-blue-300 text-sm">–ü–æ—Ç–æ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞:</span>
                                    <span id="rating-value" class="text-white font-bold text-lg">4.0</span>
                                </div>
                                <div id="rating-message"
                                    class="text-center py-2 px-3 rounded-lg bg-white bg-opacity-10">
                                    <span class="text-yellow-300 text-sm">–ü–æ—Ç—Ä—ñ–±–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ 4.8+ –¥–ª—è –ø—Ä–µ–º—ñ—ó</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5 bonus-card" id="accuracy-card">
                        <div class="relative">
                            <div class="bonus-badge" id="accuracy-bonus-indicator" style="display: none;">
                                <i class="fas fa-check-circle"></i> +15%
                            </div>
                            <div class="flex items-center mb-3">
                                <div class="icon-box mr-3 md:mr-4 bg-indigo-500/20 text-indigo-400">
                                    <i class="fas fa-bullseye text-lg"></i>
                                </div>
                                <span class="text-white font-semibold text-base sm:text-lg">–¢–æ—á–Ω—ñ—Å—Ç—å –∑–±–∏—Ä–∞–Ω–Ω—è</span>
                            </div>
                            <div class="space-y-3">
                                <input type="range" id="picking-accuracy" min="80" max="100" step="0.5" value="95"
                                    class="w-full">
                                <div class="flex justify-between items-center">
                                    <span class="text-blue-300 text-sm">–ü–æ—Ç–æ—á–Ω–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å:</span>
                                    <span id="accuracy-value" class="text-white font-bold text-lg">95.0%</span>
                                </div>
                                <div id="accuracy-message"
                                    class="text-center py-2 px-3 rounded-lg bg-white bg-opacity-10">
                                    <span class="text-yellow-300 text-sm">–ü–æ—Ç—Ä—ñ–±–Ω–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å 96%+ –¥–ª—è –ø—Ä–µ–º—ñ—ó</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4 sm:space-y-5">
                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                            <div class="flex items-center mb-2 sm:mb-0">
                                <div class="icon-box mr-3 md:mr-4 bg-blue-500/20 text-blue-400">
                                    <i class="fas fa-shopping-cart text-lg"></i>
                                </div>
                                <span class="text-white font-semibold text-base sm:text-lg">–ó—ñ–±—Ä–∞–Ω–æ —É –î–°</span>
                            </div>
                            <div class="flex items-center space-x-2 sm:space-x-3 w-full sm:w-auto justify-end">
                                <input type="number" id="dc-collected"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-20 sm:w-24 text-center text-base sm:text-lg font-bold"
                                    step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                                <span id="multiplier-dc"
                                    class="text-blue-300 font-medium multiplier text-sm sm:text-base">√ó 1.40 =</span>
                                <div
                                    class="result-display text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-3 w-24 sm:w-auto">
                                    <span id="dc-result" class="font-bold number-truncate">0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                            <div class="flex items-center mb-2 sm:mb-0">
                                <div class="icon-box mr-3 md:mr-4 bg-green-500/20 text-green-400">
                                    <i class="fas fa-store text-lg"></i>
                                </div>
                                <span class="text-white font-semibold text-base sm:text-lg">–ó—ñ–±—Ä–∞–Ω–æ —É –¢–ó</span>
                            </div>
                            <div class="flex items-center space-x-2 sm:space-x-3 w-full sm:w-auto justify-end">
                                <input type="number" id="store-collected"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-20 sm:w-24 text-center text-base sm:text-lg font-bold"
                                    step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                                <span id="multiplier-store"
                                    class="text-blue-300 font-medium multiplier text-sm sm:text-base">√ó 2.80 =</span>
                                <div
                                    class="result-display text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-3 w-24 sm:w-auto">
                                    <span id="store-result" class="font-bold number-truncate">0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                            <div class="flex items-center mb-2 sm:mb-0">
                                <div class="icon-box mr-3 md:mr-4 bg-purple-500/20 text-purple-400">
                                    <i class="fas fa-exchange-alt text-lg"></i>
                                </div>
                                <span class="text-white font-semibold text-base sm:text-lg">–ü–µ—Ä–µ–º—ñ—â–µ–Ω–æ —Ç–æ–≤–∞—Ä—ñ–≤</span>
                            </div>
                            <div class="flex items-center space-x-2 sm:space-x-3 w-full sm:w-auto justify-end">
                                <input type="number" id="dc-moved"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-20 sm:w-24 text-center text-base sm:text-lg font-bold"
                                    step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                                <span id="multiplier-moved"
                                    class="text-blue-300 font-medium multiplier text-sm sm:text-base">√ó 3.45 =</span>
                                <div
                                    class="result-display text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-3 w-24 sm:w-auto">
                                    <span id="moved-result" class="font-bold number-truncate">0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                            <div class="flex items-center mb-2 sm:mb-0">
                                <div class="icon-box mr-3 md:mr-4 bg-orange-500/20 text-orange-400">
                                    <i class="fas fa-box-open text-lg"></i>
                                </div>
                                <span class="text-white font-semibold text-base sm:text-lg">–†–æ–∑–º—ñ—â–µ–Ω–æ —Ç–æ–≤–∞—Ä—ñ–≤</span>
                            </div>
                            <div class="flex items-center space-x-2 sm:space-x-3 w-full sm:w-auto justify-end">
                                <input type="number" id="placed"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-20 sm:w-24 text-center text-base sm:text-lg font-bold"
                                    step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                                <span id="multiplier-placed"
                                    class="text-blue-300 font-medium multiplier text-sm sm:text-base">√ó 1.59 =</span>
                                <div
                                    class="result-display text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-3 w-24 sm:w-auto">
                                    <span id="placed-result" class="font-bold number-truncate">0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ù–û–í–ò–ô –ü–û–ö–ê–ó–ù–ò–ö: –í–∞–≥–∞ –∑–∞ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è —É –î–° -->
                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                            <div class="flex items-center mb-2 sm:mb-0">
                                <div class="icon-box mr-3 md:mr-4 bg-cyan-500/20 text-cyan-400">
                                    <i class="fas fa-weight text-lg"></i>
                                </div>
                                <span class="text-white font-semibold text-base sm:text-lg">–í–∞–≥–∞ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è (–∫–≥)</span>
                            </div>
                            <div class="flex items-center space-x-2 sm:space-x-3 w-full sm:w-auto justify-end">
                                <input type="number" id="weight-placement"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-20 sm:w-24 text-center text-base sm:text-lg font-bold"
                                    step="0.1" min="0" value="" pattern="[0-9]*\.?[0-9]*" inputmode="decimal"
                                    max="9999999">
                                <span id="multiplier-weight"
                                    class="text-blue-300 font-medium multiplier text-sm sm:text-base">√ó 0.14 =</span>
                                <div
                                    class="result-display text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-3 w-24 sm:w-auto">
                                    <span id="weight-result" class="font-bold number-truncate">0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ù–û–í–ò–ô –ü–û–ö–ê–ó–ù–ò–ö: –ü–∞–∫—É–≤–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                            <div class="flex items-center mb-2 sm:mb-0">
                                <div class="icon-box mr-3 md:mr-4 bg-pink-500/20 text-pink-400">
                                    <i class="fas fa-gift text-lg"></i>
                                </div>
                                <span class="text-white font-semibold text-base sm:text-lg">–ü–∞–∫—É–≤–∞–Ω–Ω—è (–∞—Ä—Ç–∏–∫—É–ª—ñ–≤)</span>
                            </div>
                            <div class="flex items-center space-x-2 sm:space-x-3 w-full sm:w-auto justify-end">
                                <input type="number" id="packing-order"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-20 sm:w-24 text-center text-base sm:text-lg font-bold"
                                    step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                                <span id="multiplier-packing"
                                    class="text-blue-300 font-medium multiplier text-sm sm:text-base">√ó 0.28 =</span>
                                <div
                                    class="result-display text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-3 w-24 sm:w-auto">
                                    <span id="packing-result" class="font-bold number-truncate">0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –î–æ–¥–∞—î–º–æ —Å–µ–∫—Ü—ñ—é –¥–ª—è —Ä–æ–±–æ—á–æ–≥–æ —á–∞—Å—É -->
                    <div class="stat-card rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-5 mt-3 sm:mt-4">
                        <div class="flex items-center mb-2 sm:mb-3">
                            <div class="icon-box mr-3 md:mr-4 bg-blue-500/20 text-blue-400">
                                <i class="fas fa-clock text-lg"></i>
                            </div>
                            <span class="text-white font-semibold text-base sm:text-lg">–†–æ–±–æ—á–∏–π —á–∞—Å (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</span>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                            <div>
                                <label
                                    class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ü–æ—á–∞—Ç–æ–∫:</label>
                                <input type="time" id="work-time-start"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-center text-sm sm:text-base">
                            </div>
                            <div>
                                <label
                                    class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ö—ñ–Ω–µ—Ü—å:</label>
                                <input type="time" id="work-time-end"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-center text-sm sm:text-base">
                            </div>
                        </div>

                        <div class="mt-2 sm:mt-3 bg-white bg-opacity-10 rounded-md sm:rounded-lg p-2 sm:p-3">
                            <div class="flex justify-between items-center">
                                <span class="text-blue-200 text-xs sm:text-sm">–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å —Ä–æ–±–æ—Ç–∏:</span>
                                <span id="work-time-total" class="text-white font-bold text-sm sm:text-base">0 –≥–æ–¥ 0
                                    —Ö–≤</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Result -->
                <div
                    class="mt-4 sm:mt-6 md:mt-8 total-result rounded-lg sm:rounded-xl p-4 sm:p-5 md:p-6 relative overflow-hidden">
                    <div class="flex flex-col sm:flex-row items-center justify-between relative z-10">
                        <div class="flex items-center mb-2 sm:mb-0">
                            <i class="fas fa-trophy text-white text-xl sm:text-2xl mr-2 sm:mr-3"></i>
                            <span class="text-white font-bold text-lg sm:text-xl md:text-2xl">–ó–∞–≥–∞–ª—å–Ω–∏–π
                                —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                        </div>
                        <div class="text-center">
                            <span id="total-result" class="text-white font-bold text-2xl sm:text-3xl">0.00</span>
                            <div id="total-with-bonus" class="text-white text-sm mt-1" style="display: none;">
                                <span class="font-semibold">–ó –ø—Ä–µ–º—ñ—è–º–∏: </span>
                                <span id="total-bonus-value" class="text-green-300 font-bold text-lg">0.00</span>
                            </div>
                            <!-- Ghost Mode Badge -->
                            <div id="ghost-mode-badge" class="mt-2" style="display: none;">
                                <span id="ghost-mode-text"
                                    class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold">
                                    <!-- Will be populated by JS -->
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Efficiency Block (Hidden by default) -->
                <div id="analytics-block"
                    class="mt-4 sm:mt-6 md:mt-8 glass-effect rounded-lg sm:rounded-xl p-4 sm:p-5 md:p-6"
                    style="display: none;">
                    <h3 class="text-lg sm:text-xl font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-chart-pie mr-2 sm:mr-3 text-blue-400"></i>
                        –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–Ω—è
                    </h3>

                    <!-- Effective Hourly Rate -->
                    <div class="stat-card rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="icon-box mr-3 bg-emerald-500/20 text-emerald-400">
                                    <i class="fas fa-coins text-lg"></i>
                                </div>
                                <span class="text-white font-semibold">–†–µ–∞–ª—å–Ω–∞ —Å—Ç–∞–≤–∫–∞ –∑–∞ –≥–æ–¥–∏–Ω—É</span>
                            </div>
                            <span id="effective-hourly-rate" class="text-emerald-400 font-bold text-2xl sm:text-3xl">0
                                –≥—Ä–Ω/–≥–æ–¥</span>
                        </div>
                    </div>

                    <!-- Alerts Section -->
                    <div id="analytics-alerts" class="space-y-3 mb-4">
                        <!-- Accuracy Alert -->
                        <div id="accuracy-alert" class="rounded-lg p-3" style="display: none;">
                            <div class="flex items-center">
                                <i id="accuracy-alert-icon" class="fas mr-2"></i>
                                <span id="accuracy-alert-text" class="font-medium"></span>
                            </div>
                        </div>
                        <!-- Rating Alert -->
                        <div id="rating-alert" class="rounded-lg p-3" style="display: none;">
                            <div class="flex items-center">
                                <i id="rating-alert-icon" class="fas mr-2"></i>
                                <span id="rating-alert-text" class="font-medium"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Income Distribution Progress Bar -->
                    <div class="stat-card rounded-lg p-4">
                        <div class="flex items-center mb-3">
                            <div class="icon-box mr-3 bg-purple-500/20 text-purple-400">
                                <i class="fas fa-chart-bar text-lg"></i>
                            </div>
                            <span class="text-white font-semibold">–†–æ–∑–ø–æ–¥—ñ–ª –¥–æ—Ö–æ–¥—É</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-6 overflow-hidden flex" id="income-progress-bar">
                            <!-- Progress segments will be dynamically added -->
                        </div>
                        <!-- Legend -->
                        <div class="flex flex-wrap gap-x-4 gap-y-2 justify-center text-xs text-gray-400">
                            <div class="flex items-center">
                                <div
                                    class="w-2.5 h-2.5 rounded-full bg-blue-500 mr-1.5 shadow-[0_0_8px_rgba(59,130,246,0.6)]">
                                </div>
                                <span>–ü—ñ–∫—ñ–Ω–≥ (–î–°+–¢–ó)</span>
                            </div>
                            <div class="flex items-center">
                                <div
                                    class="w-2.5 h-2.5 rounded-full bg-yellow-400 mr-1.5 shadow-[0_0_8px_rgba(250,204,21,0.6)]">
                                </div>
                                <span>–í–∞–≥–∞+–ü–∞–∫—É–≤–∞–Ω–Ω—è</span>
                            </div>
                            <div class="flex items-center">
                                <div
                                    class="w-2.5 h-2.5 rounded-full bg-emerald-500 mr-1.5 shadow-[0_0_8px_rgba(16,185,129,0.6)]">
                                </div>
                                <span>–ü–µ—Ä–µ–º—ñ—â./–Ü–Ω—à–µ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Share Result Button -->
                <div class="mt-4 sm:mt-6">
                    <button id="share-result-btn"
                        class="w-full text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden"
                        style="background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%); box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);">
                        <i class="fas fa-camera mr-2 sm:mr-3"></i>
                        üì∏ –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
                    </button>
                </div>

                <!-- Action Buttons -->
                <div class="mt-4 sm:mt-6 md:mt-8 space-y-3 sm:space-y-4">
                    <button id="save-btn"
                        class="w-full btn-primary btn-success text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden">
                        <i class="fas fa-save mr-2 sm:mr-3"></i>
                        –ó–±–µ—Ä–µ–≥—Ç–∏
                    </button>
                    <button id="add-manual-btn"
                        class="w-full btn-primary text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden">
                        <i class="fas fa-plus mr-2 sm:mr-3"></i>
                        –î–æ–¥–∞—Ç–∏ –≤—Ä—É—á–Ω—É
                    </button>
                    <button id="clear-inputs-btn"
                        class="w-full btn-primary btn-purple text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden">
                        <i class="fas fa-eraser mr-2 sm:mr-3"></i>
                        –û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ
                    </button>

                    <!-- Data Backup Buttons -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <button id="export-data-btn"
                            class="w-full btn-primary btn-success text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden">
                            <i class="fas fa-file-archive mr-2 sm:mr-3"></i>
                            –†–µ–∑–µ—Ä–≤–Ω–∞ –∫–æ–ø—ñ—è (JSON)
                        </button>
                        <button id="import-data-btn"
                            class="w-full btn-primary text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden">
                            <i class="fas fa-file-import mr-2 sm:mr-3"></i>
                            –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ (JSON)
                        </button>
                    </div>

                    <!-- Hidden file input for import -->
                    <input type="file" id="import-file-input" accept=".json" style="display: none;">
                </div>
            </div>

            <!-- Statistics Section -->
            <div class="glass-effect rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 fade-in">
                <h2 class="text-xl sm:text-2xl md:text-3xl font-bold text-white mb-4 sm:mb-6 md:mb-8">
                    <i class="fas fa-chart-line mr-2 sm:mr-3 text-green-400"></i>
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </h2>

                <!-- Date Range Selection -->
                <div class="mb-4 sm:mb-6 md:mb-8 space-y-3 sm:space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ó
                                –¥–∞—Ç–∏:</label>
                            <input type="date" id="date-from"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base">
                        </div>
                        <div>
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ü–æ
                                –¥–∞—Ç—É:</label>
                            <input type="date" id="date-to"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base">
                        </div>
                    </div>
                    <button id="auto-range-btn"
                        class="w-full btn-primary btn-purple text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg sm:rounded-xl text-sm sm:text-base relative overflow-hidden">
                        <i class="fas fa-calendar-alt mr-1.5 sm:mr-2"></i>
                        –ó –ø–µ—Ä—à–æ–≥–æ –ø–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π –¥–µ–Ω—å
                    </button>
                </div>

                <!-- Statistics Display -->
                <div id="stats-display" class="space-y-3 sm:space-y-4 mb-4 sm:mb-6 md:mb-8">
                    <div class="stat-card rounded-md sm:rounded-lg p-3 sm:p-4">
                        <div class="flex justify-between items-center">
                            <span class="text-blue-200 font-medium text-sm sm:text-base">–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å
                                –¥–Ω—ñ–≤:</span>
                            <span id="total-days" class="text-white font-bold text-lg sm:text-xl">0</span>
                        </div>
                    </div>

                    <div class="stat-card rounded-md sm:rounded-lg p-3 sm:p-4">
                        <div class="flex justify-between items-center">
                            <span class="text-blue-200 font-medium text-sm sm:text-base">–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å
                                –≥–æ–¥–∏–Ω:</span>
                            <span id="total-hours" class="text-white font-bold text-lg sm:text-xl">0 –≥–æ–¥ 0 —Ö–≤</span>
                        </div>
                    </div>

                    <div class="stat-card rounded-md sm:rounded-lg p-3 sm:p-4">
                        <div class="flex justify-between items-center">
                            <span class="text-blue-200 font-medium text-sm sm:text-base">–ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                            <span id="period-total" class="text-green-400 font-bold text-lg sm:text-xl">0.00</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-4 sm:mb-6 md:mb-8">
                    <!-- Daily Progress Chart -->
                    <div class="chart-container p-2 sm:p-3 md:p-4">
                        <h3 class="text-lg font-semibold text-white mb-4 text-center">–î–∏–Ω–∞–º—ñ–∫–∞ –∑–∞—Ä–æ–±—ñ—Ç–∫—É</h3>
                        <div class="relative h-64 sm:h-72 md:h-80">
                            <canvas id="statsChart"></canvas>
                        </div>
                    </div>

                    <!-- Work Distribution Chart -->
                    <div class="chart-container p-2 sm:p-3 md:p-4">
                        <h3 class="text-lg font-semibold text-white mb-4 text-center">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ—Ö–æ–¥—É</h3>
                        <div class="relative h-64 sm:h-72 md:h-80">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Heatmap Calendar Section -->
                <div class="mb-4 sm:mb-6 md:mb-8">
                    <div class="chart-container p-4 sm:p-5 md:p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-white flex items-center">
                                <i class="fas fa-calendar-alt mr-2 text-purple-400"></i>
                                –ö–∞–ª–µ–Ω–¥–∞—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
                            </h3>
                            <div class="flex items-center gap-2">
                                <button id="heatmap-prev-month"
                                    class="p-2 rounded-lg bg-white/10 hover:bg-white/20 text-white transition">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="heatmap-month-label" class="text-white font-medium px-3">–°—ñ—á–µ–Ω—å
                                    2026</span>
                                <button id="heatmap-next-month"
                                    class="p-2 rounded-lg bg-white/10 hover:bg-white/20 text-white transition">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Weekday Headers -->
                        <div class="grid grid-cols-7 gap-1 mb-2">
                            <div class="text-center text-gray-400 text-xs font-medium py-1">–ü–Ω</div>
                            <div class="text-center text-gray-400 text-xs font-medium py-1">–í—Ç</div>
                            <div class="text-center text-gray-400 text-xs font-medium py-1">–°—Ä</div>
                            <div class="text-center text-gray-400 text-xs font-medium py-1">–ß—Ç</div>
                            <div class="text-center text-gray-400 text-xs font-medium py-1">–ü—Ç</div>
                            <div class="text-center text-gray-400 text-xs font-medium py-1">–°–±</div>
                            <div class="text-center text-gray-400 text-xs font-medium py-1">–ù–¥</div>
                        </div>

                        <!-- Calendar Grid -->
                        <div id="heatmap-calendar" class="grid grid-cols-7 gap-1">
                            <!-- Days will be populated by JavaScript -->
                        </div>

                        <!-- Legend -->
                        <div class="flex items-center justify-center gap-4 mt-4 flex-wrap">
                            <div class="flex items-center gap-1.5">
                                <div class="w-4 h-4 rounded" style="background: rgba(100, 116, 139, 0.3);"></div>
                                <span class="text-gray-400 text-xs">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <div class="w-4 h-4 rounded" style="background: rgba(239, 68, 68, 0.6);"></div>
                                <span class="text-gray-400 text-xs">&lt; 600 –≥—Ä–Ω</span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <div class="w-4 h-4 rounded" style="background: rgba(250, 204, 21, 0.6);"></div>
                                <span class="text-gray-400 text-xs">600-1000 –≥—Ä–Ω</span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <div class="w-4 h-4 rounded" style="background: rgba(16, 185, 129, 0.7);"></div>
                                <span class="text-gray-400 text-xs">&gt; 1000 –≥—Ä–Ω</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CSV Export Button -->
                <div class="mb-4 sm:mb-6 md:mb-8">
                    <button id="export-csv-btn"
                        class="w-full text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden"
                        style="background: linear-gradient(135deg, #059669 0%, #10b981 100%); box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);">
                        <i class="fas fa-file-excel mr-2 sm:mr-3"></i>
                        üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–≤—ñ—Ç (Excel)
                    </button>
                </div>

                <!-- Monthly Management -->
                <div class="mb-4 sm:mb-6 md:mb-8">
                    <button id="clear-month-btn"
                        class="w-full btn-primary btn-danger text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden mb-2 sm:mb-3">
                        <i class="fas fa-trash mr-2 sm:mr-3"></i>
                        –û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ
                    </button>

                    <button id="save-to-archive-btn"
                        class="w-full btn-primary bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden">
                        <i class="fas fa-archive mr-2 sm:mr-3"></i>
                        –ó–±–µ—Ä–µ–≥—Ç–∏ –º—ñ—Å—è—Ü—å –≤ –∞—Ä—Ö—ñ–≤
                    </button>
                </div>

                <!-- Monthly Archives -->
                <div>
                    <h3 class="text-lg sm:text-xl font-bold text-white mb-3 sm:mb-4 flex items-center justify-between">
                        <div>
                            <i class="fas fa-archive mr-1.5 sm:mr-2 text-yellow-400"></i>
                            –ê—Ä—Ö—ñ–≤ –º—ñ—Å—è—Ü—ñ–≤
                        </div>
                        <button id="go-to-archive-btn"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-1.5 sm:py-2 px-3 sm:px-4 rounded-md sm:rounded-lg text-xs sm:text-sm transition duration-200">
                            <i class="fas fa-external-link-alt mr-1"></i>
                            –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∞—Ä—Ö—ñ–≤—É
                        </button>
                    </h3>
                    <div id="monthly-archives" class="space-y-2 sm:space-y-3">
                        <!-- Monthly archives will be populated here -->
                    </div>
                    <button id="delete-all-archives-btn"
                        class="w-full mt-3 sm:mt-4 btn-primary btn-danger text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg sm:rounded-xl text-base sm:text-lg relative overflow-hidden">
                        <i class="fas fa-trash-alt mr-2 sm:mr-3"></i>
                        –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –∞—Ä—Ö—ñ–≤–∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Entry Modal -->
    <!-- Manual Entry Modal -->
    <div id="manual-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop"
        aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex min-h-screen items-center justify-center p-4 text-center sm:p-0">
            <div
                class="relative transform overflow-hidden rounded-xl sm:rounded-2xl glass-effect text-left shadow-xl transition-all sm:my-8 w-full max-w-md sm:max-w-lg p-4 sm:p-6 md:p-8 modal-content">
                <h3 class="text-xl sm:text-2xl font-bold text-white mb-4 sm:mb-6 flex items-center">
                    <i class="fas fa-plus-circle mr-2 sm:mr-3 text-blue-400"></i>
                    –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å –≤—Ä—É—á–Ω—É
                </h3>

                <div class="space-y-4 sm:space-y-5">
                    <div>
                        <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–î–∞—Ç–∞:</label>
                        <input type="date" id="manual-date"
                            class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base">
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ó—ñ–±—Ä–∞–Ω–æ —É
                                –î–°:</label>
                            <input type="number" id="manual-dc-collected"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base"
                                step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                        </div>
                        <div>
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ó—ñ–±—Ä–∞–Ω–æ —É
                                –¢–ó:</label>
                            <input type="number" id="manual-store-collected"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base"
                                step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ü–µ—Ä–µ–º—ñ—â–µ–Ω–æ
                                —Ç–æ–≤–∞—Ä—ñ–≤:</label>
                            <input type="number" id="manual-dc-moved"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base"
                                step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                        </div>
                        <div>
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–†–æ–∑–º—ñ—â–µ–Ω–æ
                                —Ç–æ–≤–∞—Ä—ñ–≤:</label>
                            <input type="number" id="manual-placed"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base"
                                step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                        </div>
                    </div>

                    <!-- –ù–û–í–Ü –ü–û–õ–Ø –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–í–∞–≥–∞
                                —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è
                                (–∫–≥):</label>
                            <input type="number" id="manual-weight-placement"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base"
                                step="0.1" min="0" value="" pattern="[0-9]*\.?[0-9]*" inputmode="decimal" max="9999999">
                        </div>
                        <div>
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ü–∞–∫—É–≤–∞–Ω–Ω—è
                                (–∞—Ä—Ç–∏–∫—É–ª—ñ–≤):</label>
                            <input type="number" id="manual-packing-order"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base"
                                step="1" min="0" value="" pattern="[0-9]*" inputmode="numeric" max="9999999">
                        </div>
                    </div>

                    <!-- –ü–æ–ª—è –¥–ª—è —Ä–æ–±–æ—á–æ–≥–æ —á–∞—Å—É –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ -->
                    <div class="mt-3 sm:mt-4 md:mt-5 bg-white bg-opacity-5 rounded-lg sm:rounded-xl p-3 sm:p-4">
                        <h4 class="text-blue-200 font-medium mb-2 sm:mb-3 flex items-center text-sm sm:text-base">
                            <i class="fas fa-clock mr-1.5 sm:mr-2"></i>
                            –†–æ–±–æ—á–∏–π —á–∞—Å (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
                        </h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                            <div>
                                <label
                                    class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ü–æ—á–∞—Ç–æ–∫:</label>
                                <input type="time" id="manual-work-time-start"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-center text-sm sm:text-base">
                            </div>
                            <div>
                                <label
                                    class="block text-blue-200 text-xs sm:text-sm font-medium mb-1 sm:mb-2">–ö—ñ–Ω–µ—Ü—å:</label>
                                <input type="time" id="manual-work-time-end"
                                    class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-center text-sm sm:text-base">
                            </div>
                        </div>

                        <div class="mt-2 sm:mt-3 bg-white bg-opacity-10 rounded-md sm:rounded-lg p-2 sm:p-3">
                            <div class="flex justify-between items-center">
                                <span class="text-blue-200 text-xs sm:text-sm">–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å —Ä–æ–±–æ—Ç–∏:</span>
                                <span id="manual-work-time-total" class="text-white font-bold text-sm sm:text-base">0
                                    –≥–æ–¥ 0
                                    —Ö–≤</span>
                            </div>
                        </div>
                    </div>

                    <!-- –î–æ–¥–∞—î–º–æ –ø–æ–ª—è –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ —Ç–∞ —Ç–æ—á–Ω–æ—Å—Ç—ñ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ -->
                    <div class="mt-3 sm:mt-4 md:mt-5 space-y-3">
                        <div class="bg-white bg-opacity-5 rounded-lg sm:rounded-xl p-3 sm:p-4">
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-2">–°–µ—Ä–µ–¥–Ω—è
                                –æ—Ü—ñ–Ω–∫–∞:</label>
                            <input type="number" id="manual-rating"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base"
                                step="0.1" min="1" max="5" value="4.0">
                        </div>

                        <div class="bg-white bg-opacity-5 rounded-lg sm:rounded-xl p-3 sm:p-4">
                            <label class="block text-blue-200 text-xs sm:text-sm font-medium mb-2">–¢–æ—á–Ω—ñ—Å—Ç—å –∑–±–∏—Ä–∞–Ω–Ω—è
                                (%):</label>
                            <input type="number" id="manual-accuracy"
                                class="input-glow text-white rounded-md sm:rounded-lg px-3 py-2 sm:px-4 sm:py-3 w-full text-sm sm:text-base"
                                step="0.5" min="80" max="100" value="95">
                        </div>
                    </div>
                </div>

                <div class="mt-4 sm:mt-6 md:mt-8 grid grid-cols-2 gap-3 sm:gap-4">
                    <button id="manual-cancel-btn"
                        class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg transition duration-200 text-sm sm:text-base">
                        –°–∫–∞—Å—É–≤–∞—Ç–∏
                    </button>
                    <button id="manual-save-btn"
                        class="btn-primary btn-success text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg relative overflow-hidden text-sm sm:text-base">
                        –ó–±–µ—Ä–µ–≥—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!-- Clear Month Confirmation Modal -->
    <div id="clear-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center p-4 z-50">
        <div class="glass-effect rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 w-full max-w-md modal-content">
            <h3 class="text-xl sm:text-2xl font-bold text-white mb-3 sm:mb-4 flex items-center">
                <i class="fas fa-exclamation-triangle mr-2 sm:mr-3 text-red-400"></i>
                –û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ –º—ñ—Å—è—Ü—è
            </h3>

            <div class="mb-6 sm:mb-8">
                <p class="text-blue-200 mb-4 text-base sm:text-lg">–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—è—Ü—å, –∑–∞ —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ. <span
                        class="text-red-300 font-bold">–¶—è –¥—ñ—è –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω–∞.</span></p>

                <div class="relative">
                    <select id="clear-month-select"
                        class="w-full bg-[#1a1a2e] text-white border border-gray-600 rounded-lg py-3 px-4 focus:outline-none focus:border-purple-500 appearance-none">
                        <!-- Options will be populated by JS -->
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-400">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>

            <div class="space-y-3 sm:space-y-4">
                <button id="clear-save-btn"
                    class="w-full btn-primary btn-success text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg relative overflow-hidden text-sm sm:text-base">
                    –ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –∞—Ä—Ö—ñ–≤ —Ç–∞ –æ—á–∏—Å—Ç–∏—Ç–∏
                </button>
                <button id="clear-no-save-btn"
                    class="w-full btn-primary btn-danger text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg relative overflow-hidden text-sm sm:text-base">
                    –û—á–∏—Å—Ç–∏—Ç–∏ –±–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
                </button>
                <button id="clear-cancel-btn"
                    class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg transition duration-200 text-sm sm:text-base">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
            </div>
        </div>
    </div>

    <!-- Export Month Selection Modal -->
    <div id="export-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center p-4 z-50">
        <div class="glass-effect rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 w-full max-w-md modal-content">
            <h3 class="text-xl sm:text-2xl font-bold text-white mb-3 sm:mb-4 flex items-center">
                <i class="fas fa-file-export mr-2 sm:mr-3 text-emerald-400"></i>
                –ï–∫—Å–ø–æ—Ä—Ç –∑–≤—ñ—Ç—É
            </h3>

            <div class="mb-6 sm:mb-8">
                <p class="text-blue-200 mb-4 text-base sm:text-lg">–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—è—Ü—å –¥–ª—è —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –∑–≤—ñ—Ç—É:</p>

                <div class="relative">
                    <select id="export-month-select"
                        class="w-full bg-[#1a1a2e] text-white border border-gray-600 rounded-lg py-3 px-4 focus:outline-none focus:border-emerald-500 appearance-none">
                        <!-- Options will be populated by JS -->
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-400">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>

            <div class="space-y-3 sm:space-y-4">
                <button id="export-confirm-btn"
                    class="w-full btn-primary btn-success text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg relative overflow-hidden text-sm sm:text-base">
                    <i class="fas fa-download mr-2"></i>
                    –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel
                </button>
                <button id="export-cancel-btn"
                    class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg transition duration-200 text-sm sm:text-base">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
            </div>
        </div>
    </div>

    <!-- Import Data Confirmation Modal -->
    <div id="import-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center p-4 z-50">
        <div class="glass-effect rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 w-full max-w-md modal-content">
            <h3 class="text-xl sm:text-2xl font-bold text-white mb-3 sm:mb-4 flex items-center">
                <i class="fas fa-upload mr-2 sm:mr-3 text-blue-400"></i>
                –Ü–º–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö
            </h3>
            <p class="text-blue-200 mb-6 sm:mb-8 text-base sm:text-lg">
                –í–∏ —ñ–º–ø–æ—Ä—Ç—É—î—Ç–µ –¥–∞–Ω—ñ –∑ —Ñ–∞–π–ª—É. –û–±–µ—Ä—ñ—Ç—å —Ä–µ–∂–∏–º —ñ–º–ø–æ—Ä—Ç—É:
            </p>

            <div class="space-y-3 sm:space-y-4">
                <button id="import-replace-btn"
                    class="w-full btn-primary btn-danger text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg relative overflow-hidden text-sm sm:text-base">
                    <i class="fas fa-trash mr-2"></i>
                    –ó–∞–º—ñ–Ω–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ
                </button>
                <button id="import-merge-btn"
                    class="w-full btn-primary btn-success text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg relative overflow-hidden text-sm sm:text-base">
                    <i class="fas fa-layer-group mr-2"></i>
                    –û–±'—î–¥–Ω–∞—Ç–∏ –∑ —ñ—Å–Ω—É—é—á–∏–º–∏
                </button>
                <button id="import-cancel-btn"
                    class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg transition duration-200 text-sm sm:text-base">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
            </div>
        </div>
    </div>

    <!-- Share Result Card Modal -->
    <div id="share-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4"
        style="background: rgba(0, 0, 0, 0.95);">
        <div class="relative w-full max-w-sm">
            <!-- Close Button -->
            <button id="share-modal-close"
                class="absolute -top-12 right-0 text-gray-400 text-2xl hover:text-white transition z-10">
                <i class="fas fa-times"></i>
            </button>

            <!-- Share Card - Premium Dark Design -->
            <div id="share-card" class="rounded-3xl overflow-hidden" style="background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%); 
                       border: 1px solid rgba(255,255,255,0.1);
                       box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8), 0 0 40px rgba(16, 185, 129, 0.15);">

                <!-- Decorative Top Glow -->
                <div style="height: 4px; background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);"></div>

                <!-- Card Header with Date -->
                <div class="px-6 pt-5 pb-3 text-center">
                    <div class="relative inline-flex items-center rounded-full px-4 py-1.5 mb-2 cursor-pointer hover:bg-white/10 transition"
                        role="button" id="share-date-container"
                        style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3);">
                        <span class="text-emerald-400 font-semibold text-sm" id="share-date">üìÖ 01.01.2026</span>
                        <i class="fas fa-chevron-down ml-2 text-emerald-400 text-xs text-opacity-70"></i>
                        <!-- Hidden Date Input Anchor -->
                        <input type="date" id="share-date-picker"
                            class="absolute bottom-0 left-1/2 transform -translate-x-1/2 w-0 h-0 opacity-0 overflow-hidden"
                            style="visibility: hidden; position: absolute;">
                    </div>
                </div>

                <!-- Main Earnings Block -->
                <div class="px-6 py-4 text-center">
                    <p class="text-gray-400 text-sm uppercase tracking-widest mb-2">–ó–∞—Ä–æ–±—ñ—Ç–æ–∫ –∑–∞ –¥–µ–Ω—å</p>
                    <div class="flex items-baseline justify-center gap-2">
                        <span id="share-total" class="font-black text-6xl" style="background: linear-gradient(135deg, #10b981 0%, #34d399 50%, #6ee7b7 100%);
                                   -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
                                   filter: drop-shadow(0 0 20px rgba(16, 185, 129, 0.5));">585.33</span>
                        <span class="text-emerald-400 text-2xl font-bold">‚Ç¥</span>
                    </div>
                </div>

                <!-- Speed Badge -->
                <div class="px-6 py-2 flex justify-center">
                    <div class="inline-flex items-center gap-2 px-4 py-2 rounded-xl"
                        style="background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.3);">
                        <span class="text-xl">‚ö°</span>
                        <span id="share-hourly" class="text-blue-400 font-bold">49 –≥—Ä–Ω/–≥–æ–¥</span>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="px-5 py-4">
                    <div class="grid grid-cols-2 gap-2.5">
                        <!-- Rows Collected -->
                        <div class="rounded-xl p-3 text-center"
                            style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);">
                            <p class="text-gray-500 text-xs mb-1">üì¶ –†—è–¥–∫—ñ–≤</p>
                            <p id="share-rows" class="text-white font-bold text-lg">86</p>
                        </div>

                        <!-- Weight -->
                        <div class="rounded-xl p-3 text-center"
                            style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);">
                            <p class="text-gray-500 text-xs mb-1">‚öñÔ∏è –í–∞–≥–∞</p>
                            <p id="share-weight" class="text-white font-bold text-lg">32.1 –∫–≥</p>
                        </div>

                        <!-- Accuracy -->
                        <div class="rounded-xl p-3 text-center"
                            style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.25);">
                            <p class="text-gray-400 text-xs mb-1">üéØ –¢–æ—á–Ω—ñ—Å—Ç—å</p>
                            <p id="share-accuracy" class="text-emerald-400 font-bold text-lg">98.0%</p>
                        </div>

                        <!-- Rating -->
                        <div class="rounded-xl p-3 text-center"
                            style="background: rgba(250, 204, 21, 0.1); border: 1px solid rgba(250, 204, 21, 0.25);">
                            <p class="text-gray-400 text-xs mb-1">‚≠ê –û—Ü—ñ–Ω–∫–∞</p>
                            <p id="share-rating" class="text-yellow-400 font-bold text-lg">5.0</p>
                        </div>
                    </div>
                </div>

                <!-- Achievements -->
                <div id="share-achievements" class="px-5 pb-3">
                    <!-- Achievement badges will be added here dynamically -->
                </div>

                <!-- Footer -->
                <div class="px-6 py-3 text-center" style="background: rgba(0,0,0,0.3);">
                    <p class="text-gray-600 text-xs font-medium tracking-wide">WAREHOUSE STATS</p>
                </div>
            </div>

            <!-- Instructions -->
            <div class="text-center mt-4">
                <p class="text-gray-500 text-sm">
                    <i class="fas fa-camera mr-1"></i>
                    –ó—Ä–æ–±—ñ—Ç—å —Å–∫—Ä—ñ–Ω—à–æ—Ç —Ç–∞ –ø–æ–¥—ñ–ª—ñ—Ç—å—Å—è!
                </p>
            </div>
        </div>
    </div>

    <script>
        class WarehouseStats {
            constructor() {
                // –¢–∞—Ä–∏—Ñ–Ω—ñ –ø–ª–∞–Ω–∏
                this.tariffPlans = {
                    standard: {
                        name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç',
                        hourlyRate: 0, // –ù–µ–º–∞—î –ø–æ–≥–æ–¥–∏–Ω–Ω–æ—ó —Å—Ç–∞–≤–∫–∏
                        coefficients: {
                            dcCollected: 1.40,
                            storeCollected: 2.80,
                            dcMoved: 3.45,
                            placed: 1.59,
                            weightPlacement: 0.14,
                            packingOrder: 0.28
                        }
                    },
                    firstMonth: {
                        name: '1-–π –º—ñ—Å—è—Ü—å',
                        hourlyRate: 51.04, // –ü–æ–≥–æ–¥–∏–Ω–Ω–∞ —Å—Ç–∞–≤–∫–∞
                        coefficients: {
                            dcCollected: 0.70,
                            storeCollected: 1.40,
                            dcMoved: 1.72,
                            placed: 0.79,
                            weightPlacement: 0.07,
                            packingOrder: 0.14
                        }
                    }
                };

                // –ü–æ—Ç–æ—á–Ω–∏–π —Ç–∞—Ä–∏—Ñ–Ω–∏–π –ø–ª–∞–Ω
                this.currentTariff = localStorage.getItem('selectedTariff') || 'standard';

                // –û–ù–û–í–õ–ï–ù–Ü –ö–û–ï–§–Ü–¶–Ü–Ñ–ù–¢–ò –∑ –¥–æ–¥–∞–Ω–∏–º–∏ –Ω–æ–≤–∏–º–∏
                this.coefficients = { ...this.tariffPlans[this.currentTariff].coefficients };

                // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –±–æ–Ω—É—Å—ñ–≤
                this.bonusCoefficients = {
                    rating: 1.15,           // —è–∫—â–æ –æ—Ü—ñ–Ω–∫–∞ 4.8+
                    accuracy: 1.15          // —è–∫—â–æ —Ç–æ—á–Ω—ñ—Å—Ç—å 96%+
                };

                this.chart = null;
                this.distributionChart = null; // New Pie Chart
                this.initializeElements();
                this.bindEvents();
                this.loadData();
                this.updateCalculations();
                this.updateStatistics();
                this.loadMonthlyArchives();
                this.addLoadingAnimations();


                window.warehouseStatsInstance = this;
            }

            addLoadingAnimations() {
                const buttons = document.querySelectorAll('button');
                buttons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!btn.querySelector('.loading-spinner')) {
                            const spinner = document.createElement('div');
                            spinner.className = 'loading-spinner';
                            btn.insertBefore(spinner, btn.firstChild);

                            setTimeout(() => {
                                if (spinner.parentNode) {
                                    spinner.remove();
                                }
                            }, 1000);
                        }
                    });
                });
            };

            initializeElements() {
                try {
                    // –û—Å–Ω–æ–≤–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –≤–≤–æ–¥—É
                    this.dcCollectedInput = document.getElementById('dc-collected');
                    this.storeCollectedInput = document.getElementById('store-collected');
                    this.dcMovedInput = document.getElementById('dc-moved');
                    this.placedInput = document.getElementById('placed');
                    this.weightPlacementInput = document.getElementById('weight-placement'); // –ù–û–í–ò–ô
                    this.packingOrderInput = document.getElementById('packing-order'); // –ù–û–í–ò–ô

                    // –ï–ª–µ–º–µ–Ω—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
                    this.dcResult = document.getElementById('dc-result');
                    this.storeResult = document.getElementById('store-result');
                    this.movedResult = document.getElementById('moved-result');
                    this.placedResult = document.getElementById('placed-result');
                    this.weightResult = document.getElementById('weight-result'); // –ù–û–í–ò–ô
                    this.packingResult = document.getElementById('packing-result'); // –ù–û–í–ò–ô
                    this.totalResult = document.getElementById('total-result');

                    // –ï–ª–µ–º–µ–Ω—Ç–∏ –±–æ–Ω—É—Å—ñ–≤
                    this.averageRating = document.getElementById('average-rating');
                    this.pickingAccuracy = document.getElementById('picking-accuracy');
                    this.ratingValue = document.getElementById('rating-value');
                    this.accuracyValue = document.getElementById('accuracy-value');

                    // –ö–Ω–æ–ø–∫–∏
                    this.saveBtn = document.getElementById('save-btn');
                    this.addManualBtn = document.getElementById('add-manual-btn');
                    this.clearInputsBtn = document.getElementById('clear-inputs-btn');
                    this.autoRangeBtn = document.getElementById('auto-range-btn');
                    this.clearMonthBtn = document.getElementById('clear-month-btn');
                    this.deleteAllArchivesBtn = document.getElementById('delete-all-archives-btn');

                    // –ü–æ–ª—è –¥–∞—Ç
                    this.dateFrom = document.getElementById('date-from');
                    this.dateTo = document.getElementById('date-to');

                    // –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞
                    this.manualModal = document.getElementById('manual-modal');
                    this.clearModal = document.getElementById('clear-modal');
                    this.importModal = document.getElementById('import-modal');

                    // Data backup elements
                    this.exportDataBtn = document.getElementById('export-data-btn');
                    this.importDataBtn = document.getElementById('import-data-btn');
                    this.importFileInput = document.getElementById('import-file-input');
                    this.importedData = null; // Store imported data temporarily

                    // –¢–∞—Ä–∏—Ñ–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
                    this.tariffStandardBtn = document.getElementById('tariff-standard');
                    this.tariffFirstMonthBtn = document.getElementById('tariff-first-month');
                    this.tariffInfo = document.getElementById('tariff-info');
                    this.hourlyRateSection = document.getElementById('hourly-rate-section');
                    this.hourlyHoursWorked = document.getElementById('hourly-hours-worked');
                    this.hourlyEarnings = document.getElementById('hourly-earnings');

                    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞—Ä–∏—Ñ—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
                    this.initializeTariff();

                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –≤ initializeElements:', error);
                }
            }

            initializeTariff() {
                // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—ó –∫–Ω–æ–ø–∫–∏ —Ç–∞—Ä–∏—Ñ—É
                if (this.currentTariff === 'firstMonth') {
                    this.tariffStandardBtn?.classList.remove('active');
                    this.tariffFirstMonthBtn?.classList.add('active');
                    if (this.hourlyRateSection) this.hourlyRateSection.style.display = 'block';
                    if (this.tariffInfo) this.tariffInfo.innerHTML = '<span class="text-emerald-400 text-sm"><i class="fas fa-seedling mr-1"></i>–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –¥–ª—è 1-–≥–æ –º—ñ—Å—è—Ü—è + –ø–æ–≥–æ–¥–∏–Ω–Ω–∞ —Å—Ç–∞–≤–∫–∞</span>';
                } else {
                    this.tariffStandardBtn?.classList.add('active');
                    this.tariffFirstMonthBtn?.classList.remove('active');
                    if (this.hourlyRateSection) this.hourlyRateSection.style.display = 'none';
                    if (this.tariffInfo) this.tariffInfo.innerHTML = '<span class="text-blue-300 text-sm">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏</span>';
                }
                this.updateMultiplierDisplay();
            }

            switchTariff(tariffKey) {
                if (!this.tariffPlans[tariffKey]) return;

                this.currentTariff = tariffKey;
                localStorage.setItem('selectedTariff', tariffKey);

                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤
                this.coefficients = { ...this.tariffPlans[tariffKey].coefficients };

                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI
                if (tariffKey === 'firstMonth') {
                    this.tariffStandardBtn?.classList.remove('active');
                    this.tariffFirstMonthBtn?.classList.add('active');
                    if (this.hourlyRateSection) this.hourlyRateSection.style.display = 'block';
                    if (this.tariffInfo) this.tariffInfo.innerHTML = '<span class="text-emerald-400 text-sm"><i class="fas fa-seedling mr-1"></i>–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –¥–ª—è 1-–≥–æ –º—ñ—Å—è—Ü—è + –ø–æ–≥–æ–¥–∏–Ω–Ω–∞ —Å—Ç–∞–≤–∫–∞</span>';
                } else {
                    this.tariffStandardBtn?.classList.add('active');
                    this.tariffFirstMonthBtn?.classList.remove('active');
                    if (this.hourlyRateSection) this.hourlyRateSection.style.display = 'none';
                    if (this.tariffInfo) this.tariffInfo.innerHTML = '<span class="text-blue-300 text-sm">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏</span>';
                }

                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤
                this.updateMultiplierDisplay();

                // –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫
                this.updateCalculations();

                // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                this.showSuccessMessage(`–¢–∞—Ä–∏—Ñ –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${this.tariffPlans[tariffKey].name}`);
            }

            updateMultiplierDisplay() {
                const multipliers = {
                    'multiplier-dc': this.coefficients.dcCollected,
                    'multiplier-store': this.coefficients.storeCollected,
                    'multiplier-moved': this.coefficients.dcMoved,
                    'multiplier-placed': this.coefficients.placed,
                    'multiplier-weight': this.coefficients.weightPlacement,
                    'multiplier-packing': this.coefficients.packingOrder
                };

                Object.entries(multipliers).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = `√ó ${value.toFixed(2)} =`;
                        // –ê–Ω—ñ–º–∞—Ü—ñ—è –∑–º—ñ–Ω–∏
                        element.style.transform = 'scale(1.1)';
                        element.style.color = '#10b981';
                        setTimeout(() => {
                            element.style.transform = '';
                            element.style.color = '';
                        }, 300);
                    }
                });
            }

            updateHourlyEarnings() {
                if (this.currentTariff !== 'firstMonth') return;

                const hours = parseFloat(this.hourlyHoursWorked?.value) || 0;
                const hourlyRate = this.tariffPlans.firstMonth.hourlyRate;
                const earnings = hours * hourlyRate;

                if (this.hourlyEarnings) {
                    this.animateNumberChange(this.hourlyEarnings, earnings);
                }
            }

            bindEvents() {
                const safeAddEventListener = (element, event, handler) => {
                    if (element) {
                        element.addEventListener(event, handler);
                    }
                };

                // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–∏—Ö —ñ–Ω–ø—É—Ç—ñ–≤ (–¥–æ–¥–∞—î–º–æ –Ω–æ–≤—ñ)
                [this.dcCollectedInput, this.storeCollectedInput, this.dcMovedInput,
                this.placedInput, this.packingOrderInput]
                    .filter(input => input)
                    .forEach(input => {
                        safeAddEventListener(input, 'keypress', (e) => {
                            if (!/[0-9]/.test(e.key)) {
                                e.preventDefault();
                            }
                        });

                        safeAddEventListener(input, 'input', () => {
                            input.value = input.value.replace(/[^0-9]/g, '');
                            if (parseFloat(input.value) > 9999999) {
                                input.value = 9999999;
                            }
                            this.updateCalculations();
                            this.animateResultUpdate(input);
                        });
                    });

                // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –ø–æ–ª—è –≤–∞–≥–∏ (–¥–æ–∑–≤–æ–ª—è—î–º–æ –¥–µ—Å—è—Ç–∫–æ–≤—ñ —á–∏—Å–ª–∞)
                if (this.weightPlacementInput) {
                    safeAddEventListener(this.weightPlacementInput, 'keypress', (e) => {
                        const char = String.fromCharCode(e.which);
                        if (!/[0-9.]/.test(char)) {
                            e.preventDefault();
                        }
                        // –î–æ–∑–≤–æ–ª—è—î–º–æ –ª–∏—à–µ –æ–¥–Ω—É –∫—Ä–∞–ø–∫—É
                        if (char === '.' && this.weightPlacementInput.value.includes('.')) {
                            e.preventDefault();
                        }
                    });

                    safeAddEventListener(this.weightPlacementInput, 'input', () => {
                        // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ —Å–∏–º–≤–æ–ª–∏ –∫—Ä—ñ–º —Ü–∏—Ñ—Ä —Ç–∞ –∫—Ä–∞–ø–∫–∏
                        let value = this.weightPlacementInput.value.replace(/[^0-9.]/g, '');
                        // –ó–∞–ª–∏—à–∞—î–º–æ –ª–∏—à–µ –æ–¥–Ω—É –∫—Ä–∞–ø–∫—É
                        const parts = value.split('.');
                        if (parts.length > 2) {
                            value = parts[0] + '.' + parts.slice(1).join('');
                        }
                        this.weightPlacementInput.value = value;
                        if (parseFloat(value) > 9999999) {
                            this.weightPlacementInput.value = 9999999;
                        }
                        this.updateCalculations();
                        this.animateResultUpdate(this.weightPlacementInput);
                    });
                }

                // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è —Ç–∞—Ä–∏—Ñ–Ω–∏—Ö –∫–Ω–æ–ø–æ–∫
                safeAddEventListener(this.tariffStandardBtn, 'click', () => this.switchTariff('standard'));
                safeAddEventListener(this.tariffFirstMonthBtn, 'click', () => this.switchTariff('firstMonth'));

                // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –ø–æ–≥–æ–¥–∏–Ω–Ω–æ–≥–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
                safeAddEventListener(this.hourlyHoursWorked, 'input', () => {
                    this.updateHourlyEarnings();
                    this.updateCalculations();
                });

                // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä—ñ–≤ –±–æ–Ω—É—Å—ñ–≤
                safeAddEventListener(this.averageRating, 'input', () => {
                    this.ratingValue.textContent = parseFloat(this.averageRating.value).toFixed(1);
                    this.updateBonusDisplay();
                    this.updateCalculations();
                });

                safeAddEventListener(this.pickingAccuracy, 'input', () => {
                    this.accuracyValue.textContent = parseFloat(this.pickingAccuracy.value).toFixed(1) + '%';
                    this.updateBonusDisplay();
                    this.updateCalculations();
                });

                // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –ø–æ–ª—ñ–≤ —Ä–æ–±–æ—á–æ–≥–æ —á–∞—Å—É
                const workTimeStart = document.getElementById('work-time-start');
                const workTimeEnd = document.getElementById('work-time-end');

                [workTimeStart, workTimeEnd].filter(input => input).forEach(input => {
                    safeAddEventListener(input, 'change', () => {
                        this.validateTimeInput(input);
                        this.updateWorkTimeTotal();
                        this.updateCalculations(); // Update analytics with new work time
                    });
                });

                // –û—Å–Ω–æ–≤–Ω—ñ –∫–Ω–æ–ø–∫–∏
                safeAddEventListener(this.saveBtn, 'click', () => this.saveData());
                safeAddEventListener(this.addManualBtn, 'click', () => this.showManualModal());
                safeAddEventListener(this.clearInputsBtn, 'click', () => this.clearInputFields());
                safeAddEventListener(this.autoRangeBtn, 'click', () => this.setAutoRange());
                safeAddEventListener(this.clearMonthBtn, 'click', () => this.showClearMonthModal());
                safeAddEventListener(this.deleteAllArchivesBtn, 'click', () => this.confirmDeleteAllArchives());

                // Data backup buttons
                safeAddEventListener(this.exportDataBtn, 'click', () => this.exportData());
                safeAddEventListener(this.importDataBtn, 'click', () => this.triggerFileImport());
                safeAddEventListener(this.importFileInput, 'change', (e) => this.handleFileSelect(e));

                // Import modal buttons
                const importReplaceBtn = document.getElementById('import-replace-btn');
                const importMergeBtn = document.getElementById('import-merge-btn');
                const importCancelBtn = document.getElementById('import-cancel-btn');
                safeAddEventListener(importReplaceBtn, 'click', () => this.importData(false));
                safeAddEventListener(importMergeBtn, 'click', () => this.importData(true));
                safeAddEventListener(importCancelBtn, 'click', () => this.hideImportModal());

                // Share modal buttons
                const shareResultBtn = document.getElementById('share-result-btn');
                const shareModalClose = document.getElementById('share-modal-close');
                safeAddEventListener(shareResultBtn, 'click', () => this.showShareModal());
                safeAddEventListener(shareModalClose, 'click', () => this.hideShareModal());

                // Close share modal on background click
                const shareModal = document.getElementById('share-modal');
                safeAddEventListener(shareModal, 'click', (e) => {
                    if (e.target === shareModal) this.hideShareModal();
                });

                // Share Modal Date Picker
                const shareDateContainer = document.getElementById('share-date-container');
                const shareDatePicker = document.getElementById('share-date-picker');

                safeAddEventListener(shareDateContainer, 'click', () => {
                    try {
                        if (shareDatePicker.showPicker) {
                            shareDatePicker.showPicker();
                        } else {
                            shareDatePicker.click();
                        }
                    } catch (error) {
                        console.error('Error showing date picker:', error);
                        // Fallback - make sure it's clickable and click it
                        shareDatePicker.style.display = 'block';
                        shareDatePicker.click();
                        shareDatePicker.style.display = 'none';
                    }
                });

                safeAddEventListener(shareDatePicker, 'change', (e) => {
                    if (e.target.value) {
                        this.updateShareCard(e.target.value);
                    }
                });

                // Heatmap Calendar navigation
                this.heatmapMonth = new Date().getMonth();
                this.heatmapYear = new Date().getFullYear();

                const heatmapPrevBtn = document.getElementById('heatmap-prev-month');
                const heatmapNextBtn = document.getElementById('heatmap-next-month');
                safeAddEventListener(heatmapPrevBtn, 'click', () => {
                    this.heatmapMonth--;
                    if (this.heatmapMonth < 0) {
                        this.heatmapMonth = 11;
                        this.heatmapYear--;
                    }
                    this.renderHeatmapCalendar();
                });
                safeAddEventListener(heatmapNextBtn, 'click', () => {
                    this.heatmapMonth++;
                    if (this.heatmapMonth > 11) {
                        this.heatmapMonth = 0;
                        this.heatmapYear++;
                    }
                    this.renderHeatmapCalendar();
                });

                // Initial render of heatmap
                this.renderHeatmapCalendar();

                // CSV Export button - Now opens Modal
                const exportCsvBtn = document.getElementById('export-csv-btn');
                if (exportCsvBtn) safeAddEventListener(exportCsvBtn, 'click', () => this.showExportModal());

                const saveToArchiveBtn = document.getElementById('save-to-archive-btn');
                safeAddEventListener(saveToArchiveBtn, 'click', () => this.saveToArchive());

                // –ü–æ–ª—è –¥–∞—Ç
                [this.dateFrom, this.dateTo].filter(input => input).forEach(input =>
                    safeAddEventListener(input, 'change', () => this.updateStatistics()));

                // Manual modal
                const manualSaveBtn = document.getElementById('manual-save-btn');
                const manualCancelBtn = document.getElementById('manual-cancel-btn');
                safeAddEventListener(manualSaveBtn, 'click', () => this.saveManualData());
                safeAddEventListener(manualCancelBtn, 'click', () => this.hideManualModal());

                // Clear modal
                const clearSaveBtn = document.getElementById('clear-save-btn');
                const clearNoSaveBtn = document.getElementById('clear-no-save-btn');
                const clearCancelBtn = document.getElementById('clear-cancel-btn');
                safeAddEventListener(clearSaveBtn, 'click', () => this.clearMonthData(true));
                safeAddEventListener(clearNoSaveBtn, 'click', () => this.clearMonthData(false));
                safeAddEventListener(clearCancelBtn, 'click', () => this.hideClearMonthModal());

                // Export Modal buttons
                const exportConfirmBtn = document.getElementById('export-confirm-btn');
                const exportCancelBtn = document.getElementById('export-cancel-btn');
                safeAddEventListener(exportConfirmBtn, 'click', () => this.exportMonthData());
                safeAddEventListener(exportCancelBtn, 'click', () => this.hideExportModal());

                // –ü–æ–ª—è —É –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ (–¥–æ–¥–∞—î–º–æ –Ω–æ–≤—ñ)
                ['manual-dc-collected', 'manual-store-collected', 'manual-dc-moved',
                    'manual-placed', 'manual-packing-order'].forEach(id => {
                        const input = document.getElementById(id);
                        if (input) {
                            safeAddEventListener(input, 'keypress', (e) => {
                                if (!/[0-9]/.test(e.key)) {
                                    e.preventDefault();
                                }
                            });

                            safeAddEventListener(input, 'input', () => {
                                input.value = input.value.replace(/[^0-9]/g, '');
                                if (parseFloat(input.value) > 9999999) {
                                    input.value = 9999999;
                                }
                            });
                        }
                    });

                // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –ø–æ–ª—è –≤–∞–≥–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ
                const manualWeightInput = document.getElementById('manual-weight-placement');
                if (manualWeightInput) {
                    safeAddEventListener(manualWeightInput, 'keypress', (e) => {
                        const char = String.fromCharCode(e.which);
                        if (!/[0-9.]/.test(char)) {
                            e.preventDefault();
                        }
                        if (char === '.' && manualWeightInput.value.includes('.')) {
                            e.preventDefault();
                        }
                    });

                    safeAddEventListener(manualWeightInput, 'input', () => {
                        let value = manualWeightInput.value.replace(/[^0-9.]/g, '');
                        const parts = value.split('.');
                        if (parts.length > 2) {
                            value = parts[0] + '.' + parts.slice(1).join('');
                        }
                        manualWeightInput.value = value;
                        if (parseFloat(value) > 9999999) {
                            manualWeightInput.value = 9999999;
                        }
                    });
                }

                // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥—É –¥–æ –∞—Ä—Ö—ñ–≤—É
                const goToArchiveBtn = document.getElementById('go-to-archive-btn');
                safeAddEventListener(goToArchiveBtn, 'click', () => {
                    window.location.href = 'archive-list.html';
                });

                // –†–æ–±–æ—á–∏–π —á–∞—Å —É –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ
                const manualWorkTimeStart = document.getElementById('manual-work-time-start');
                const manualWorkTimeEnd = document.getElementById('manual-work-time-end');

                [manualWorkTimeStart, manualWorkTimeEnd].filter(input => input).forEach(input => {
                    safeAddEventListener(input, 'change', () => {
                        this.validateTimeInput(input);
                        this.updateManualWorkTimeTotal();
                    });
                });
            }

            updateBonusDisplay() {
                const rating = parseFloat(this.averageRating.value);
                const accuracy = parseFloat(this.pickingAccuracy.value);

                const ratingCard = document.getElementById('rating-card');
                const accuracyCard = document.getElementById('accuracy-card');
                const ratingMessage = document.getElementById('rating-message');
                const accuracyMessage = document.getElementById('accuracy-message');
                const ratingIndicator = document.getElementById('rating-bonus-indicator');
                const accuracyIndicator = document.getElementById('accuracy-bonus-indicator');

                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ—Ü—ñ–Ω–∫–∏
                if (rating >= 4.8) {
                    ratingCard.classList.add('bonus-card');
                    ratingCard.classList.remove('no-bonus-card');
                    ratingMessage.innerHTML = '<span class="text-green-300 text-sm font-semibold"><i class="fas fa-check-circle mr-1"></i>–ü—Ä–µ–º—ñ—è –∑–∞ –æ—Ü—ñ–Ω–∫—É –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω–∞! +15%</span>';
                    ratingIndicator.style.display = 'block';
                } else {
                    ratingCard.classList.remove('bonus-card');
                    ratingCard.classList.add('no-bonus-card');
                    ratingMessage.innerHTML = '<span class="text-red-300 text-sm"><i class="fas fa-times-circle mr-1"></i>–í–∞—à–∞ –æ—Ü—ñ–Ω–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—è –¥–ª—è –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –ø—Ä–µ–º—ñ—ó</span>';
                    ratingIndicator.style.display = 'none';
                }

                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç—ñ
                if (accuracy >= 96) {
                    accuracyCard.classList.add('bonus-card');
                    accuracyCard.classList.remove('no-bonus-card');
                    accuracyMessage.innerHTML = '<span class="text-green-300 text-sm font-semibold"><i class="fas fa-check-circle mr-1"></i>–ü—Ä–µ–º—ñ—è –∑–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω–∞! +15%</span>';
                    accuracyIndicator.style.display = 'block';
                } else {
                    accuracyCard.classList.remove('bonus-card');
                    accuracyCard.classList.add('no-bonus-card');
                    accuracyMessage.innerHTML = '<span class="text-red-300 text-sm"><i class="fas fa-times-circle mr-1"></i>–í–∞—à–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—è –¥–ª—è –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –ø—Ä–µ–º—ñ—ó</span>';
                    accuracyIndicator.style.display = 'none';
                }
            }

            animateResultUpdate(input) {
                const parentCard = input.closest('.stat-card');
                if (parentCard) {
                    parentCard.style.transform = 'scale(1.02)';
                    parentCard.style.boxShadow = '0 15px 35px rgba(59, 130, 246, 0.3)';

                    setTimeout(() => {
                        parentCard.style.transform = '';
                        parentCard.style.boxShadow = '';
                    }, 200);
                }
            }

            updateCalculations() {
                const dcCollected = parseFloat(this.dcCollectedInput.value) || 0;
                const storeCollected = parseFloat(this.storeCollectedInput.value) || 0;
                const dcMoved = parseFloat(this.dcMovedInput.value) || 0;
                const placed = parseFloat(this.placedInput.value) || 0;
                const weightPlacement = parseFloat(this.weightPlacementInput.value) || 0; // –ù–û–í–ò–ô
                const packingOrder = parseFloat(this.packingOrderInput.value) || 0; // –ù–û–í–ò–ô

                const dcResult = dcCollected * this.coefficients.dcCollected;
                const storeResult = storeCollected * this.coefficients.storeCollected;
                const movedResult = dcMoved * this.coefficients.dcMoved;
                const placedResult = placed * this.coefficients.placed;
                const weightResult = weightPlacement * this.coefficients.weightPlacement; // –ù–û–í–ò–ô
                const packingResult = packingOrder * this.coefficients.packingOrder; // –ù–û–í–ò–ô

                this.animateNumberChange(this.dcResult, dcResult);
                this.animateNumberChange(this.storeResult, storeResult);
                this.animateNumberChange(this.movedResult, movedResult);
                this.animateNumberChange(this.placedResult, placedResult);
                this.animateNumberChange(this.weightResult, weightResult); // –ù–û–í–ò–ô
                this.animateNumberChange(this.packingResult, packingResult); // –ù–û–í–ò–ô

                const articlesTotal = dcResult + storeResult + movedResult + placedResult + weightResult + packingResult; // –ó–∞–≥–∞–ª—å–Ω–∏–π –∑–∞—Ä–æ–±—ñ—Ç–æ–∫ –∑–∞ –∞—Ä—Ç–∏–∫—É–ª–∏

                // –î–æ–¥–∞—î–º–æ –ø–æ–≥–æ–¥–∏–Ω–Ω–∏–π –∑–∞—Ä–æ–±—ñ—Ç–æ–∫ –¥–ª—è 1-–≥–æ –º—ñ—Å—è—Ü—è
                let hourlyEarnings = 0;
                if (this.currentTariff === 'firstMonth' && this.hourlyHoursWorked) {
                    const hours = parseFloat(this.hourlyHoursWorked.value) || 0;
                    hourlyEarnings = hours * this.tariffPlans.firstMonth.hourlyRate;
                    if (this.hourlyEarnings) {
                        this.animateNumberChange(this.hourlyEarnings, hourlyEarnings);
                    }
                }

                const total = articlesTotal + hourlyEarnings;
                this.animateNumberChange(this.totalResult, total);

                // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑ –±–æ–Ω—É—Å–∞–º–∏
                const rating = parseFloat(this.averageRating.value);
                const accuracy = parseFloat(this.pickingAccuracy.value);

                let totalWithBonuses = total;
                let bonusMultiplier = 1;

                if (rating >= 4.8) {
                    bonusMultiplier *= this.bonusCoefficients.rating;
                }
                if (accuracy >= 96) {
                    bonusMultiplier *= this.bonusCoefficients.accuracy;
                }

                totalWithBonuses = total * bonusMultiplier;

                const totalWithBonusDiv = document.getElementById('total-with-bonus');
                const totalBonusValue = document.getElementById('total-bonus-value');

                if (bonusMultiplier > 1) {
                    totalWithBonusDiv.style.display = 'block';
                    this.animateNumberChange(totalBonusValue, totalWithBonuses);
                } else {
                    totalWithBonusDiv.style.display = 'none';
                }

                // Update Day Efficiency Analytics
                this.updateDayAnalytics({
                    total: totalWithBonuses || total,
                    dcResult,
                    storeResult,
                    movedResult,
                    placedResult,
                    weightResult,
                    packingResult,
                    rating,
                    accuracy
                });

                // Update Ghost Mode (comparison with last shift)
                this.updateGhostMode(totalWithBonuses || total);
            }

            animateNumberChange(element, newValue) {
                const oldValue = parseFloat(element.textContent) || 0;
                const duration = 300;
                const startTime = performance.now();

                const animate = (currentTime) => {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    const currentValue = oldValue + (newValue - oldValue) * progress;

                    if (Math.abs(currentValue) > 999999) {
                        element.textContent = currentValue.toExponential(2);
                    } else {
                        element.textContent = currentValue.toFixed(2);
                    }

                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };

                requestAnimationFrame(animate);
            }

            updateDayAnalytics(data) {
                const analyticsBlock = document.getElementById('analytics-block');
                const effectiveHourlyRateEl = document.getElementById('effective-hourly-rate');
                const accuracyAlert = document.getElementById('accuracy-alert');
                const accuracyAlertIcon = document.getElementById('accuracy-alert-icon');
                const accuracyAlertText = document.getElementById('accuracy-alert-text');
                const ratingAlert = document.getElementById('rating-alert');
                const ratingAlertIcon = document.getElementById('rating-alert-icon');
                const ratingAlertText = document.getElementById('rating-alert-text');
                const progressBar = document.getElementById('income-progress-bar');

                // Only show analytics if there's any income
                const hasData = data.total > 0;
                analyticsBlock.style.display = hasData ? 'block' : 'none';

                if (!hasData) return;

                // Calculate Effective Hourly Rate
                const workTimeStart = document.getElementById('work-time-start').value;
                const workTimeEnd = document.getElementById('work-time-end').value;
                let workHours = 0;

                if (workTimeStart && workTimeEnd) {
                    const startParts = workTimeStart.split(':');
                    const endParts = workTimeEnd.split(':');

                    const startDate = new Date();
                    startDate.setHours(parseInt(startParts[0]), parseInt(startParts[1]), 0);

                    const endDate = new Date();
                    endDate.setHours(parseInt(endParts[0]), parseInt(endParts[1]), 0);

                    if (endDate < startDate) {
                        endDate.setDate(endDate.getDate() + 1);
                    }

                    workHours = (endDate - startDate) / (1000 * 60 * 60);
                }

                // Display effective hourly rate
                if (workHours > 0) {
                    const effectiveRate = data.total / workHours;
                    effectiveHourlyRateEl.textContent = `${Math.round(effectiveRate)} –≥—Ä–Ω/–≥–æ–¥`;
                } else {
                    effectiveHourlyRateEl.textContent = '‚Äî (–≤–∫–∞–∂—ñ—Ç—å —á–∞—Å)';
                }

                // Accuracy Alert
                if (data.accuracy < 96) {
                    accuracyAlert.style.display = 'block';
                    accuracyAlert.className = 'rounded-lg p-3 bg-red-500/20 border border-red-500/50';
                    accuracyAlertIcon.className = 'fas fa-exclamation-triangle mr-2 text-red-400';
                    accuracyAlertText.className = 'font-medium text-red-300';
                    accuracyAlertText.textContent = '–£–í–ê–ì–ê: –ù–∏–∑—å–∫–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å! –ü—Ä–µ–º—ñ—è –ø—ñ–¥ –∑–∞–≥—Ä–æ–∑–æ—é.';
                } else {
                    accuracyAlert.style.display = 'block';
                    accuracyAlert.className = 'rounded-lg p-3 bg-green-500/20 border border-green-500/50';
                    accuracyAlertIcon.className = 'fas fa-check-circle mr-2 text-green-400';
                    accuracyAlertText.className = 'font-medium text-green-300';
                    accuracyAlertText.textContent = '–°—É–ø–µ—Ä! –¢–æ—á–Ω—ñ—Å—Ç—å –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–ª—è –ø—Ä–µ–º—ñ—ó.';
                }

                // Rating Alert
                if (data.rating < 4.8) {
                    ratingAlert.style.display = 'block';
                    ratingAlert.className = 'rounded-lg p-3 bg-yellow-500/20 border border-yellow-500/50';
                    ratingAlertIcon.className = 'fas fa-star-half-alt mr-2 text-yellow-400';
                    ratingAlertText.className = 'font-medium text-yellow-300';
                    ratingAlertText.textContent = '–ü—ñ–¥—Ç—è–≥–Ω–∏ –æ—Ü—ñ–Ω–∫—É –¥–æ 4.8!';
                } else {
                    ratingAlert.style.display = 'block';
                    ratingAlert.className = 'rounded-lg p-3 bg-green-500/20 border border-green-500/50';
                    ratingAlertIcon.className = 'fas fa-star mr-2 text-green-400';
                    ratingAlertText.className = 'font-medium text-green-300';
                    ratingAlertText.textContent = '–°—É–ø–µ—Ä! –û—Ü—ñ–Ω–∫–∞ –¥–æ—Å—Ç–∞—Ç–Ω—è –¥–ª—è –ø—Ä–µ–º—ñ—ó.';
                }

                // Income Distribution Progress Bar
                const picking = data.dcResult + data.storeResult; // –ü—ñ–∫—ñ–Ω–≥ (–î–° + –¢–ó) - blue
                const weightPacking = data.weightResult + data.packingResult; // –í–∞–≥–∞ + –ü–∞–∫—É–≤–∞–Ω–Ω—è - yellow
                const other = data.movedResult + data.placedResult; // –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è + –†–æ–∑–º—ñ—â–µ–Ω–Ω—è - green

                const total = picking + weightPacking + other;

                if (total > 0) {
                    const pickingPercent = (picking / total) * 100;
                    const weightPackingPercent = (weightPacking / total) * 100;
                    const otherPercent = (other / total) * 100;

                    progressBar.innerHTML = `
                        <div class="h-full bg-blue-500 transition-all duration-500" style="width: ${pickingPercent}%;" title="–ü—ñ–∫—ñ–Ω–≥: ${picking.toFixed(2)} –≥—Ä–Ω (${pickingPercent.toFixed(1)}%)"></div>
                        <div class="h-full bg-yellow-500 transition-all duration-500" style="width: ${weightPackingPercent}%;" title="–í–∞–≥–∞+–ü–∞–∫—É–≤–∞–Ω–Ω—è: ${weightPacking.toFixed(2)} –≥—Ä–Ω (${weightPackingPercent.toFixed(1)}%)"></div>
                        <div class="h-full bg-green-500 transition-all duration-500" style="width: ${otherPercent}%;" title="–ü–µ—Ä–µ–º—ñ—â./–Ü–Ω—à–µ: ${other.toFixed(2)} –≥—Ä–Ω (${otherPercent.toFixed(1)}%)"></div>
                    `;
                } else {
                    progressBar.innerHTML = '';
                }
            }

            updateGhostMode(currentTotal) {
                const ghostBadge = document.getElementById('ghost-mode-badge');
                const ghostText = document.getElementById('ghost-mode-text');

                if (!ghostBadge || !ghostText) return;

                // Get saved data from localStorage
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                const dates = Object.keys(savedData).sort().reverse(); // Sort dates descending

                // Get today's date
                const now = new Date();
                const today = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;

                // Find the last saved shift (excluding today)
                let lastShiftTotal = null;
                for (const date of dates) {
                    if (date !== today && savedData[date]) {
                        lastShiftTotal = savedData[date].totalWithBonuses || savedData[date].total || 0;
                        break;
                    }
                }

                // If no previous shift data, hide badge
                if (lastShiftTotal === null || currentTotal === 0) {
                    ghostBadge.style.display = 'none';
                    return;
                }

                // Calculate difference
                const difference = currentTotal - lastShiftTotal;

                // Show badge with comparison
                ghostBadge.style.display = 'block';

                if (difference > 0) {
                    // Positive - green badge
                    ghostText.style.background = 'rgba(16, 185, 129, 0.2)';
                    ghostText.style.color = '#34d399';
                    ghostText.style.border = '1px solid rgba(16, 185, 129, 0.4)';
                    ghostText.innerHTML = `<i class="fas fa-arrow-up mr-1"></i>+${difference.toFixed(0)} –≥—Ä–Ω –≤—ñ–¥ –º–∏–Ω—É–ª–æ—ó –∑–º—ñ–Ω–∏`;
                } else if (difference < 0) {
                    // Negative - red badge
                    ghostText.style.background = 'rgba(239, 68, 68, 0.2)';
                    ghostText.style.color = '#f87171';
                    ghostText.style.border = '1px solid rgba(239, 68, 68, 0.4)';
                    ghostText.innerHTML = `<i class="fas fa-arrow-down mr-1"></i>${difference.toFixed(0)} –≥—Ä–Ω –≤—ñ–¥ –º–∏–Ω—É–ª–æ—ó –∑–º—ñ–Ω–∏`;
                } else {
                    // Same - yellow badge
                    ghostText.style.background = 'rgba(250, 204, 21, 0.2)';
                    ghostText.style.color = '#fcd34d';
                    ghostText.style.border = '1px solid rgba(250, 204, 21, 0.4)';
                    ghostText.innerHTML = `<i class="fas fa-equals mr-1"></i>–¢–∞–∫ —Å–∞–º–æ —è–∫ –º–∏–Ω—É–ª–∞ –∑–º—ñ–Ω–∞`;
                }
            }

            renderHeatmapCalendar() {
                const calendarGrid = document.getElementById('heatmap-calendar');
                const monthLabel = document.getElementById('heatmap-month-label');

                if (!calendarGrid || !monthLabel) return;

                // Ukrainian month names
                const monthNames = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å',
                    '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];

                monthLabel.textContent = `${monthNames[this.heatmapMonth]} ${this.heatmapYear}`;

                // Get saved data
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');

                // Calculate calendar layout
                const firstDay = new Date(this.heatmapYear, this.heatmapMonth, 1);
                const lastDay = new Date(this.heatmapYear, this.heatmapMonth + 1, 0);
                const daysInMonth = lastDay.getDate();

                // Get day of week (0 = Sunday, adjust for Monday start)
                let startDayOfWeek = firstDay.getDay();
                startDayOfWeek = startDayOfWeek === 0 ? 6 : startDayOfWeek - 1; // Convert to Monday = 0

                // Generate calendar HTML
                let html = '';

                // Empty cells before first day
                for (let i = 0; i < startDayOfWeek; i++) {
                    html += '<div class="aspect-square rounded-lg" style="background: transparent;"></div>';
                }

                // Day cells
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${this.heatmapYear}-${(this.heatmapMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                    const dayData = savedData[dateStr];

                    let bgColor = 'rgba(100, 116, 139, 0.3)'; // Grey - no data
                    let tooltip = '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö';

                    if (dayData) {
                        const total = dayData.totalWithBonuses || dayData.total || 0;
                        tooltip = `${day}.${(this.heatmapMonth + 1).toString().padStart(2, '0')} | ${total.toFixed(0)} –≥—Ä–Ω`;

                        if (total < 600) {
                            bgColor = 'rgba(239, 68, 68, 0.6)'; // Red - weak day
                        } else if (total <= 1000) {
                            bgColor = 'rgba(250, 204, 21, 0.6)'; // Yellow - average day
                        } else {
                            bgColor = 'rgba(16, 185, 129, 0.7)'; // Green - powerful day
                        }
                    }

                    html += `<div class="aspect-square rounded-lg flex items-center justify-center text-white text-xs font-medium cursor-pointer hover:opacity-80 transition"
                                 style="background: ${bgColor};"
                                 data-date="${dateStr}"
                                 data-tooltip="${tooltip}"
                                 onclick="window.warehouseStatsInstance.showDayDetails('${dateStr}')">
                                ${day}
                             </div>`;
                }

                calendarGrid.innerHTML = html;
            }

            showDayDetails(dateStr) {
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                const dayData = savedData[dateStr];

                const [year, month, day] = dateStr.split('-');
                const formattedDate = `${day}.${month}.${year}`;

                if (dayData) {
                    const total = dayData.totalWithBonuses || dayData.total || 0;

                    const dc = dayData.dcCollected || 0;
                    const store = dayData.storeCollected || 0;
                    const moved = dayData.dcMoved || 0;
                    const placed = dayData.placed || 0;
                    const packing = dayData.packingOrder || 0;
                    const weight = dayData.weightPlacement || 0;

                    alert(`üìÖ –î–∞—Ç–∞: ${formattedDate}\nüí∞ –°—É–º–∞: ${total.toFixed(2)} –≥—Ä–Ω\n\nüìù –î–µ—Ç–∞–ª—ñ:\nüî∏ –î–° (–ø—ñ–∫—ñ–Ω–≥): ${dc}\nüîπ –¢–ó (–ø—ñ–∫—ñ–Ω–≥): ${store}\nüîÑ –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è: ${moved}\nüì• –†–æ–∑–º—ñ—â–µ–Ω–Ω—è: ${placed}\nüì¶ –ü–∞–∫—É–≤–∞–Ω–Ω—è: ${packing}\n‚öñÔ∏è –í–∞–≥–∞: ${weight.toFixed(1)} –∫–≥`);
                } else {
                    alert(`üìÖ –î–∞—Ç–∞: ${formattedDate}\n‚ùå –î–∞–Ω–∏—Ö –Ω–µ–º–∞—î`);
                }
            }

            exportToCsv() {
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                const dates = Object.keys(savedData).sort();

                if (dates.length === 0) {
                    this.showErrorMessage('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É!');
                    return;
                }

                // CSV Header with BOM for UTF-8 encoding in Excel
                const BOM = '\uFEFF';
                let csv = BOM + '–î–∞—Ç–∞;–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ (–≥—Ä–Ω);–ó—ñ–±—Ä–∞–Ω–æ –î–°;–ó—ñ–±—Ä–∞–Ω–æ –¢–ó;–ü–µ—Ä–µ–º—ñ—â–µ–Ω–æ –î–°;–†–æ–∑–º—ñ—â–µ–Ω–æ;–ü–∞–∫—É–≤–∞–Ω–Ω—è;–í–∞–≥–∞ (–∫–≥);–ì–æ–¥–∏–Ω —Ä–æ–±–æ—Ç–∏;–®–≤–∏–¥–∫—ñ—Å—Ç—å (–≥—Ä–Ω/–≥–æ–¥)\n';

                // Add data rows
                for (const date of dates) {
                    const data = savedData[date];
                    const [year, month, day] = date.split('-');
                    const formattedDate = `${day}.${month}.${year}`;

                    const total = (data.totalWithBonuses || data.total || 0).toFixed(2);

                    const dc = (data.dcCollected || 0);
                    const store = (data.storeCollected || 0);
                    const moved = (data.dcMoved || 0);
                    const placed = (data.placed || 0);
                    const packing = (data.packingOrder || 0);
                    const weight = (data.weightPlacement || 0).toFixed(1);

                    // Calculate work hours
                    const workMinutes = data.workTimeTotal || 0;
                    const workHours = (workMinutes / 60).toFixed(1);

                    // Calculate speed (grn/hour)
                    const speed = workMinutes > 0 ? ((data.totalWithBonuses || data.total || 0) / (workMinutes / 60)).toFixed(0) : '0';

                    csv += `${formattedDate};${total};${dc};${store};${moved};${placed};${packing};${weight};${workHours};${speed}\n`;
                }

                // Create and download file
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);

                const now = new Date();
                const fileName = `Warehouse_Report_${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}.csv`;

                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                this.showSuccessMessage('–ó–≤—ñ—Ç —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!');
            }

            updateShareCard(dateStr) {
                // Formatting
                const [year, month, day] = dateStr.split('-');
                const formattedDate = `${day}.${month}.${year}`;

                // Update Date Display
                document.getElementById('share-date').textContent = `üìÖ ${formattedDate}`;

                // Fetch Data
                let data = {};

                // Check if it's today's data (live form data)
                const now = new Date();
                const today = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;

                if (dateStr === today && document.getElementById('dc-collected')) {
                    // Use live calculations if available
                    // Helper to get float value
                    const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;

                    const dcCollected = getVal('dc-collected');
                    const storeCollected = getVal('store-collected');
                    const dcMoved = getVal('dc-moved');
                    const placed = getVal('placed');
                    const weightPlacement = getVal('weight-placement'); // Matches ID
                    const packingOrder = getVal('packing-order'); // Matches ID

                    const dcResult = dcCollected * this.coefficients.dcCollected;
                    const storeResult = storeCollected * this.coefficients.storeCollected;
                    const movedResult = dcMoved * this.coefficients.dcMoved;
                    const placedResult = placed * this.coefficients.placed;
                    const weightResult = weightPlacement * this.coefficients.weightPlacement;
                    const packingResult = packingOrder * this.coefficients.packingOrder;

                    const total = dcResult + storeResult + movedResult + placedResult + weightResult + packingResult;

                    const rating = getVal('average-rating');
                    const accuracy = getVal('picking-accuracy');

                    let bonusMultiplier = 1;
                    if (rating >= 4.8) bonusMultiplier *= this.bonusCoefficients.rating;
                    if (accuracy >= 96) bonusMultiplier *= this.bonusCoefficients.accuracy;

                    const totalWithBonuses = total * bonusMultiplier;

                    const workMinutes = this.calculateWorkMinutes();

                    data = {
                        totalWithBonuses,
                        total,
                        rows: dcCollected + storeCollected,
                        weight: weightPlacement,
                        accuracy,
                        rating,
                        workTimeTotal: workMinutes
                    };
                } else {
                    // Fetch from localStorage
                    const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                    if (savedData[dateStr]) {
                        const saved = savedData[dateStr];
                        data = {
                            totalWithBonuses: saved.totalWithBonuses || saved.total || 0,
                            total: saved.total || 0,
                            rows: (saved.dcCollected || 0) + (saved.storeCollected || 0),
                            weight: saved.weightPlacement || 0,
                            accuracy: saved.accuracy || 0,
                            rating: saved.rating || 0,
                            workTimeTotal: saved.workTimeTotal || 0
                        };
                    } else {
                        // No data found
                        data = {
                            totalWithBonuses: 0,
                            total: 0,
                            rows: 0,
                            weight: 0,
                            accuracy: 0,
                            rating: 0,
                            workTimeTotal: 0
                        };
                    }
                }

                // Update UI Elements
                const shareTotal = document.getElementById('share-total');
                if (shareTotal) shareTotal.textContent = `${data.totalWithBonuses.toFixed(0)} –≥—Ä–Ω`;
                else return;

                // Hourly Speed
                let hourlySpeed = 0;
                if (data.workTimeTotal > 0) {
                    hourlySpeed = data.totalWithBonuses / (data.workTimeTotal / 60);
                }
                document.getElementById('share-hourly').textContent = `${hourlySpeed.toFixed(0)} –≥—Ä–Ω/–≥–æ–¥`;

                // Stats
                document.getElementById('share-rows').textContent = data.rows;
                document.getElementById('share-weight').textContent = `${data.weight.toFixed(1)} –∫–≥`;
                document.getElementById('share-accuracy').textContent = `${data.accuracy}`;
                document.getElementById('share-rating').textContent = data.rating;

                // Badges
                const badgesContainer = document.getElementById('share-achievements');
                badgesContainer.innerHTML = ''; // Clear existing

                const addBadge = (icon, text, color) => {
                    const badge = document.createElement('div');
                    badge.className = `flex items-center px-3 py-1 rounded-full text-xs font-semibold backdrop-blur-sm shadow-sm`;
                    badge.style.background = `rgba(${color}, 0.1)`;
                    badge.style.border = `1px solid rgba(${color}, 0.2)`;
                    badge.style.color = `rgb(${color})`;
                    badge.innerHTML = `<i class="${icon} mr-1.5"></i>${text}`;
                    badgesContainer.appendChild(badge);
                };

                // Logic for badges based on DATA (not hardcoded)
                if (data.totalWithBonuses >= 1500) addBadge('fas fa-fire', '–¢–æ–ø –¥–Ω—è', '250, 204, 21'); // Yellow
                if (data.accuracy >= 99) addBadge('fas fa-bullseye', '–°–Ω–∞–π–ø–µ—Ä', '16, 185, 129'); // Green
                if (hourlySpeed >= 150) addBadge('fas fa-bolt', '–¢—É—Ä–±–æ —Ä–µ–∂–∏–º', '59, 130, 246'); // Blue
                if (data.rating >= 4.9) addBadge('fas fa-star', '–ó—ñ—Ä–∫–∞ —Å–∫–ª–∞–¥—É', '236, 72, 153'); // Pink
            }

            calculateWorkMinutes() {
                const workTimeStart = document.getElementById('work-time-start');
                const workTimeEnd = document.getElementById('work-time-end');

                if (!workTimeStart || !workTimeEnd) return 0;

                const startVal = workTimeStart.value;
                const endVal = workTimeEnd.value;

                if (startVal && endVal) {
                    const startParts = startVal.split(':');
                    const endParts = endVal.split(':');

                    const startDate = new Date();
                    startDate.setHours(parseInt(startParts[0]), parseInt(startParts[1]), 0);

                    const endDate = new Date();
                    endDate.setHours(parseInt(endParts[0]), parseInt(endParts[1]), 0);

                    if (endDate < startDate) {
                        endDate.setDate(endDate.getDate() + 1);
                    }
                    return (endDate - startDate) / (1000 * 60);
                }
                return 0;
            }

            updateShareCard(dateStr) {
                // Formatting
                const [year, month, day] = dateStr.split('-');
                const formattedDate = `${day}.${month}.${year}`;

                // Update Date Display
                document.getElementById('share-date').textContent = `üìÖ ${formattedDate}`;

                // Fetch Data
                let data = {};

                // Check if it's today's data (live form data)
                const now = new Date();
                const today = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;

                if (dateStr === today && document.getElementById('dc-collected')) {
                    // Use live calculations if available
                    // Helper to get float value
                    const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;

                    const dcCollected = getVal('dc-collected');
                    const storeCollected = getVal('store-collected');
                    const dcMoved = getVal('dc-moved');
                    const placed = getVal('placed');
                    const weightPlacement = getVal('weight-placement'); // Matches ID
                    const packingOrder = getVal('packing-order'); // Matches ID

                    const dcResult = dcCollected * this.coefficients.dcCollected;
                    const storeResult = storeCollected * this.coefficients.storeCollected;
                    const movedResult = dcMoved * this.coefficients.dcMoved;
                    const placedResult = placed * this.coefficients.placed;
                    const weightResult = weightPlacement * this.coefficients.weightPlacement;
                    const packingResult = packingOrder * this.coefficients.packingOrder;

                    const total = dcResult + storeResult + movedResult + placedResult + weightResult + packingResult;

                    const rating = getVal('average-rating');
                    const accuracy = getVal('picking-accuracy');

                    let bonusMultiplier = 1;
                    if (rating >= 4.8) bonusMultiplier *= this.bonusCoefficients.rating;
                    if (accuracy >= 96) bonusMultiplier *= this.bonusCoefficients.accuracy;

                    const totalWithBonuses = total * bonusMultiplier;

                    const workMinutes = this.calculateWorkMinutes();

                    data = {
                        totalWithBonuses,
                        total,
                        rows: dcCollected + storeCollected,
                        weight: weightPlacement,
                        accuracy,
                        rating,
                        workTimeTotal: workMinutes
                    };
                } else {
                    // Fetch from localStorage
                    const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                    if (savedData[dateStr]) {
                        const saved = savedData[dateStr];
                        data = {
                            totalWithBonuses: saved.totalWithBonuses || saved.total || 0,
                            total: saved.total || 0,
                            rows: (saved.dcCollected || 0) + (saved.storeCollected || 0),
                            weight: saved.weightPlacement || 0,
                            accuracy: saved.accuracy || 0,
                            rating: saved.rating || 0,
                            workTimeTotal: saved.workTimeTotal || 0
                        };
                    } else {
                        // No data found
                        data = {
                            totalWithBonuses: 0,
                            total: 0,
                            rows: 0,
                            weight: 0,
                            accuracy: 0,
                            rating: 0,
                            workTimeTotal: 0
                        };
                    }
                }

                // Update UI Elements
                const shareTotal = document.getElementById('share-total');
                if (shareTotal) shareTotal.textContent = `${data.totalWithBonuses.toFixed(0)} –≥—Ä–Ω`;
                else return; // Safety check

                // Hourly Speed
                let hourlySpeed = 0;
                if (data.workTimeTotal > 0) {
                    hourlySpeed = data.totalWithBonuses / (data.workTimeTotal / 60);
                }
                document.getElementById('share-hourly').textContent = `${hourlySpeed.toFixed(0)} –≥—Ä–Ω/–≥–æ–¥`;

                // Stats
                document.getElementById('share-rows').textContent = data.rows;
                document.getElementById('share-weight').textContent = `${data.weight.toFixed(1)} –∫–≥`;
                document.getElementById('share-accuracy').textContent = `${data.accuracy}`;
                document.getElementById('share-rating').textContent = data.rating;

                // Badges
                const badgesContainer = document.getElementById('share-achievements');
                badgesContainer.innerHTML = ''; // Clear existing

                const addBadge = (icon, text, color) => {
                    const badge = document.createElement('div');
                    badge.className = `flex items-center px-3 py-1 rounded-full text-xs font-semibold backdrop-blur-sm shadow-sm`;
                    badge.style.background = `rgba(${color}, 0.1)`;
                    badge.style.border = `1px solid rgba(${color}, 0.2)`;
                    badge.style.color = `rgb(${color})`;
                    badge.innerHTML = `<i class="${icon} mr-1.5"></i>${text}`;
                    badgesContainer.appendChild(badge);
                };

                // Logic for badges based on DATA (not hardcoded)
                if (data.totalWithBonuses >= 1500) addBadge('fas fa-fire', '–¢–æ–ø –¥–Ω—è', '250, 204, 21'); // Yellow
                if (data.accuracy >= 99) addBadge('fas fa-bullseye', '–°–Ω–∞–π–ø–µ—Ä', '16, 185, 129'); // Green
                if (hourlySpeed >= 150) addBadge('fas fa-bolt', '–¢—É—Ä–±–æ —Ä–µ–∂–∏–º', '59, 130, 246'); // Blue
                if (data.rating >= 4.9) addBadge('fas fa-star', '–ó—ñ—Ä–∫–∞ —Å–∫–ª–∞–¥—É', '236, 72, 153'); // Pink
            }

            calculateWorkMinutes() {
                const workTimeStart = document.getElementById('work-time-start');
                const workTimeEnd = document.getElementById('work-time-end');

                if (!workTimeStart || !workTimeEnd) return 0;

                const startVal = workTimeStart.value;
                const endVal = workTimeEnd.value;

                if (startVal && endVal) {
                    const startParts = startVal.split(':');
                    const endParts = endVal.split(':');

                    const startDate = new Date();
                    startDate.setHours(parseInt(startParts[0]), parseInt(startParts[1]), 0);

                    const endDate = new Date();
                    endDate.setHours(parseInt(endParts[0]), parseInt(endParts[1]), 0);

                    if (endDate < startDate) {
                        endDate.setDate(endDate.getDate() + 1);
                    }
                    return (endDate - startDate) / (1000 * 60);
                }
                return 0;
            }

            saveData() {
                const now = new Date();
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const today = `${year}-${month}-${day}`;

                const dcCollected = parseFloat(this.dcCollectedInput.value) || 0;
                const storeCollected = parseFloat(this.storeCollectedInput.value) || 0;
                const dcMoved = parseFloat(this.dcMovedInput.value) || 0;
                const placed = parseFloat(this.placedInput.value) || 0;
                const weightPlacement = parseFloat(this.weightPlacementInput.value) || 0; // –ù–û–í–ò–ô
                const packingOrder = parseFloat(this.packingOrderInput.value) || 0; // –ù–û–í–ò–ô

                const dcResult = dcCollected * this.coefficients.dcCollected;
                const storeResult = storeCollected * this.coefficients.storeCollected;
                const movedResult = dcMoved * this.coefficients.dcMoved;
                const placedResult = placed * this.coefficients.placed;
                const weightResult = weightPlacement * this.coefficients.weightPlacement; // –ù–û–í–ò–ô
                const packingResult = packingOrder * this.coefficients.packingOrder; // –ù–û–í–ò–ô

                const total = dcResult + storeResult + movedResult + placedResult + weightResult + packingResult; // –û–ù–û–í–õ–ï–ù–û

                // –ë–æ–Ω—É—Å–∏
                const rating = parseFloat(this.averageRating.value);
                const accuracy = parseFloat(this.pickingAccuracy.value);

                let bonusMultiplier = 1;
                if (rating >= 4.8) bonusMultiplier *= this.bonusCoefficients.rating;
                if (accuracy >= 96) bonusMultiplier *= this.bonusCoefficients.accuracy;

                const totalWithBonuses = total * bonusMultiplier;

                // –†–æ–±–æ—á–∏–π —á–∞—Å
                const workTimeStart = document.getElementById('work-time-start').value;
                const workTimeEnd = document.getElementById('work-time-end').value;

                let workTimeTotal = 0;
                if (workTimeStart && workTimeEnd) {
                    const startParts = workTimeStart.split(':');
                    const endParts = workTimeEnd.split(':');

                    const startDate = new Date();
                    startDate.setHours(parseInt(startParts[0]), parseInt(startParts[1]), 0);

                    const endDate = new Date();
                    endDate.setHours(parseInt(endParts[0]), parseInt(endParts[1]), 0);

                    if (endDate < startDate) {
                        endDate.setDate(endDate.getDate() + 1);
                    }

                    workTimeTotal = (endDate - startDate) / (1000 * 60);
                }

                const data = {
                    date: today,
                    dcCollected: dcCollected,
                    storeCollected: storeCollected,
                    dcMoved: dcMoved,
                    placed: placed,
                    weightPlacement: weightPlacement, // –ù–û–í–ò–ô
                    packingOrder: packingOrder, // –ù–û–í–ò–ô
                    total: total,
                    totalWithBonuses: totalWithBonuses,
                    rating: rating,
                    accuracy: accuracy,
                    bonusMultiplier: bonusMultiplier,
                    workTimeStart: workTimeStart,
                    workTimeEnd: workTimeEnd,
                    workTimeTotal: workTimeTotal
                };

                let savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                savedData[today] = data;
                localStorage.setItem('warehouseData', JSON.stringify(savedData));

                this.updateStatistics();
                this.renderHeatmapCalendar(); // Refresh calendar after save
                this.showSuccessAnimation();
            }

            showSuccessAnimation() {
                const successMessage = document.createElement('div');
                successMessage.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                successMessage.innerHTML = '<i class="fas fa-check mr-2"></i>–î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!';
                successMessage.style.animation = 'slideInRight 0.3s ease-out';

                document.body.appendChild(successMessage);

                setTimeout(() => {
                    successMessage.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => successMessage.remove(), 300);
                }, 2000);
            }

            saveManualData() {
                const date = document.getElementById('manual-date').value;
                if (!date) {
                    this.showErrorMessage('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É!');
                    return;
                }

                const dcCollected = Math.min(parseFloat(document.getElementById('manual-dc-collected').value) || 0, 9999999);
                const storeCollected = Math.min(parseFloat(document.getElementById('manual-store-collected').value) || 0, 9999999);
                const dcMoved = Math.min(parseFloat(document.getElementById('manual-dc-moved').value) || 0, 9999999);
                const placed = Math.min(parseFloat(document.getElementById('manual-placed').value) || 0, 9999999);
                const weightPlacement = Math.min(parseFloat(document.getElementById('manual-weight-placement').value) || 0, 9999999); // –ù–û–í–ò–ô
                const packingOrder = Math.min(parseFloat(document.getElementById('manual-packing-order').value) || 0, 9999999); // –ù–û–í–ò–ô

                const total = (dcCollected * this.coefficients.dcCollected) +
                    (storeCollected * this.coefficients.storeCollected) +
                    (dcMoved * this.coefficients.dcMoved) +
                    (placed * this.coefficients.placed) +
                    (weightPlacement * this.coefficients.weightPlacement) + // –ù–û–í–ò–ô
                    (packingOrder * this.coefficients.packingOrder); // –ù–û–í–ò–ô

                // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ –±–æ–Ω—É—Å–∏
                const rating = parseFloat(document.getElementById('manual-rating').value) || 4.0;
                const accuracy = parseFloat(document.getElementById('manual-accuracy').value) || 95;

                let bonusMultiplier = 1;
                if (rating >= 4.8) bonusMultiplier *= this.bonusCoefficients.rating;
                if (accuracy >= 96) bonusMultiplier *= this.bonusCoefficients.accuracy;

                const totalWithBonuses = total * bonusMultiplier;

                // –†–æ–±–æ—á–∏–π —á–∞—Å
                const workTimeStart = document.getElementById('manual-work-time-start').value;
                const workTimeEnd = document.getElementById('manual-work-time-end').value;

                let workTimeTotal = 0;
                if (workTimeStart && workTimeEnd) {
                    const startParts = workTimeStart.split(':');
                    const endParts = workTimeEnd.split(':');

                    const startDate = new Date();
                    startDate.setHours(parseInt(startParts[0]), parseInt(startParts[1]), 0);

                    const endDate = new Date();
                    endDate.setHours(parseInt(endParts[0]), parseInt(endParts[1]), 0);

                    if (endDate < startDate) {
                        endDate.setDate(endDate.getDate() + 1);
                    }

                    workTimeTotal = (endDate - startDate) / (1000 * 60);
                }

                const data = {
                    date: date,
                    dcCollected: dcCollected,
                    storeCollected: storeCollected,
                    dcMoved: dcMoved,
                    placed: placed,
                    weightPlacement: weightPlacement, // –ù–û–í–ò–ô
                    packingOrder: packingOrder, // –ù–û–í–ò–ô
                    total: total,
                    totalWithBonuses: totalWithBonuses,
                    rating: rating,
                    accuracy: accuracy,
                    bonusMultiplier: bonusMultiplier,
                    workTimeStart: workTimeStart,
                    workTimeEnd: workTimeEnd,
                    workTimeTotal: workTimeTotal
                };

                let savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                savedData[date] = data;
                localStorage.setItem('warehouseData', JSON.stringify(savedData));

                this.hideManualModal();
                this.updateStatistics();
                this.renderHeatmapCalendar(); // Refresh calendar after save
                this.showSuccessAnimation();
            };

            showErrorMessage(message) {
                const errorMessage = document.createElement('div');
                errorMessage.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                errorMessage.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i>${message}`;
                errorMessage.style.animation = 'slideInRight 0.3s ease-out';

                document.body.appendChild(errorMessage);

                setTimeout(() => {
                    errorMessage.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => errorMessage.remove(), 300);
                }, 3000);
            };

            showShareModal() {
                const modal = document.getElementById('share-modal');
                if (!modal) return;

                // Set default date to today
                const now = new Date();
                const today = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;

                // Initialize date picker
                const datePicker = document.getElementById('share-date-picker');
                if (datePicker) {
                    datePicker.value = today; // Reset to today on open
                }

                // Initial Update
                this.updateShareCard(today);

                // Show modal
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.style.overflow = 'hidden';
            }

            hideShareModal() {
                const shareModal = document.getElementById('share-modal');
                if (shareModal) {
                    shareModal.classList.add('hidden');
                    document.body.style.overflow = '';
                }
            }

            loadData() {
                const now = new Date();
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const today = `${year}-${month}-${day}`;

                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');

                if (savedData[today]) {
                    const data = savedData[today];
                    this.dcCollectedInput.value = data.dcCollected || '';
                    this.storeCollectedInput.value = data.storeCollected || '';
                    this.dcMovedInput.value = data.dcMoved || '';
                    this.placedInput.value = data.placed || '';
                    this.weightPlacementInput.value = data.weightPlacement || ''; // –ù–û–í–ò–ô
                    this.packingOrderInput.value = data.packingOrder || ''; // –ù–û–í–ò–ô

                    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –æ—Ü—ñ–Ω–∫—É —ñ —Ç–æ—á–Ω—ñ—Å—Ç—å
                    if (data.rating) {
                        this.averageRating.value = data.rating;
                        this.ratingValue.textContent = parseFloat(data.rating).toFixed(1);
                    }
                    if (data.accuracy) {
                        this.pickingAccuracy.value = data.accuracy;
                        this.accuracyValue.textContent = parseFloat(data.accuracy).toFixed(1) + '%';
                    }

                    document.getElementById('work-time-start').value = data.workTimeStart || '';
                    document.getElementById('work-time-end').value = data.workTimeEnd || '';

                    this.updateWorkTimeTotal();
                    this.updateBonusDisplay();
                } else {
                    this.dcCollectedInput.value = '';
                    this.storeCollectedInput.value = '';
                    this.dcMovedInput.value = '';
                    this.placedInput.value = '';
                    this.weightPlacementInput.value = ''; // –ù–û–í–ò–ô
                    this.packingOrderInput.value = ''; // –ù–û–í–ò–ô

                    document.getElementById('work-time-start').value = '';
                    document.getElementById('work-time-end').value = '';
                    document.getElementById('work-time-total').textContent = '0 –≥–æ–¥ 0 —Ö–≤';
                }
            };

            updateStatistics() {
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                const fromDate = this.dateFrom.value;
                const toDate = this.dateTo.value;

                let filteredData = Object.values(savedData);

                if (fromDate && toDate) {
                    filteredData = filteredData.filter(item =>
                        item.date >= fromDate && item.date <= toDate
                    );
                }

                document.getElementById('total-days').textContent = filteredData.length;

                let totalWorkMinutes = 0;
                filteredData.forEach(item => {
                    totalWorkMinutes += item.workTimeTotal || 0;
                });

                const totalHours = Math.floor(totalWorkMinutes / 60);
                const totalMinutes = Math.floor(totalWorkMinutes % 60);
                document.getElementById('total-hours').textContent = `${totalHours} –≥–æ–¥ ${totalMinutes} —Ö–≤`;

                // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ totalWithBonuses —è–∫—â–æ —î, —ñ–Ω–∞–∫—à–µ total
                const periodTotal = filteredData.reduce((sum, item) => sum + (item.totalWithBonuses || item.total || 0), 0);

                if (Math.abs(periodTotal) > 999999) {
                    document.getElementById('period-total').textContent = periodTotal.toExponential(2);
                } else {
                    this.animateNumberChange(document.getElementById('period-total'), periodTotal);
                }

                this.updateChart(filteredData);
                this.updateDistributionChart(filteredData); // Update Pie Chart
            };

            updateChart(data) {
                try {
                    const chartCanvas = document.getElementById('statsChart');
                    if (!chartCanvas) return;

                    if (this.chart) {
                        this.chart.destroy();
                        this.chart = null;
                        const ctx = chartCanvas.getContext('2d');
                        ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
                    }

                    if (!data || data.length === 0) {
                        const ctx = chartCanvas.getContext('2d');
                        ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
                        return;
                    }

                    const ctx = chartCanvas.getContext('2d');
                    const sortedData = data.sort((a, b) => new Date(a.date) - new Date(b.date));

                    setTimeout(() => {
                        this.chart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: sortedData.map(item => {
                                    const date = new Date(item.date);
                                    return `${date.getDate()}/${date.getMonth() + 1}`;
                                }),
                                datasets: [{
                                    label: '–ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç',
                                    data: sortedData.map(item => item.totalWithBonuses || item.total || 0),
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    borderWidth: 3,
                                    fill: true,
                                    tension: 0.4,
                                    pointBackgroundColor: '#10b981',
                                    pointBorderColor: '#ffffff',
                                    pointBorderWidth: 2,
                                    pointRadius: 6,
                                    pointHoverRadius: 8
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: {
                                    duration: 1000,
                                    easing: 'easeOutQuart'
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            color: '#94a3b8',
                                            font: {
                                                family: "'Outfit', sans-serif",
                                                size: 12,
                                                weight: 500
                                            },
                                            usePointStyle: true,
                                            padding: 20
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                                        titleColor: '#f8fafc',
                                        bodyColor: '#cbd5e1',
                                        borderColor: 'rgba(255, 255, 255, 0.1)',
                                        borderWidth: 1,
                                        padding: 12,
                                        displayColors: false,
                                        callbacks: {
                                            label: function (context) {
                                                return '–†–µ–∑—É–ª—å—Ç–∞—Ç: ' + context.parsed.y.toFixed(2);
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    x: {
                                        ticks: {
                                            color: '#94a3b8',
                                            font: {
                                                family: "'Outfit', sans-serif",
                                                size: 11
                                            }
                                        },
                                        grid: {
                                            color: 'rgba(255, 255, 255, 0.05)',
                                            drawBorder: false
                                        }
                                    },
                                    y: {
                                        ticks: {
                                            color: '#94a3b8',
                                            font: {
                                                family: "'Outfit', sans-serif",
                                                size: 11
                                            },
                                            callback: function (value) {
                                                return value.toFixed(0);
                                            }
                                        },
                                        grid: {
                                            color: 'rgba(255, 255, 255, 0.05)',
                                            drawBorder: false
                                        }
                                    }
                                },
                                interaction: {
                                    intersect: false,
                                    mode: 'index'
                                }
                            }
                        });
                    }, 50);

                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –¥—ñ–∞–≥—Ä–∞–º–∏:", error);
                }
            };


            updateDistributionChart(filteredData) {
                // Calculate totals first
                let totals = {
                    dcCollected: 0,
                    storeCollected: 0,
                    dcMoved: 0,
                    placed: 0,
                    weightPlacement: 0,
                    packingOrder: 0,
                    other: 0 // For legacy data or discrepancies
                };

                filteredData.forEach(item => {
                    const itemDcCollected = parseFloat(item.dcCollected || 0) * this.coefficients.dcCollected;
                    const itemStoreCollected = parseFloat(item.storeCollected || 0) * this.coefficients.storeCollected;
                    const itemDcMoved = parseFloat(item.dcMoved || 0) * this.coefficients.dcMoved;
                    const itemPlaced = parseFloat(item.placed || 0) * this.coefficients.placed;
                    const itemWeightPlacement = parseFloat(item.weightPlacement || 0) * this.coefficients.weightPlacement;
                    const itemPackingOrder = parseFloat(item.packingOrder || 0) * this.coefficients.packingOrder;

                    totals.dcCollected += itemDcCollected;
                    totals.storeCollected += itemStoreCollected;
                    totals.dcMoved += itemDcMoved;
                    totals.placed += itemPlaced;
                    totals.weightPlacement += itemWeightPlacement;
                    totals.packingOrder += itemPackingOrder;

                    // Calculate known total for this item
                    const knownTotal = itemDcCollected + itemStoreCollected + itemDcMoved + itemPlaced + itemWeightPlacement + itemPackingOrder;

                    // Get actual total (use totalWithBonuses if available, otherwise total)
                    const actualTotal = parseFloat(item.totalWithBonuses || item.total || 0);

                    // If actual total is significantly larger than known total, treat difference as "Other/Archived"
                    if (actualTotal > knownTotal + 1) { // +1 for float precision tolerance
                        totals.other += (actualTotal - knownTotal);
                    }
                });

                // Prepare data for chart
                const hasOther = totals.other > 1;

                let chartLabels = ['–ó–±—ñ—Ä (–†–¶)', '–ó–±—ñ—Ä (–ú–∞–≥)', '–ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è', '–†–æ–∑–∫–ª–∞–¥–∞–Ω–Ω—è', '–í–∞–≥–∞', '–ü–∞–∫—É–≤–∞–Ω–Ω—è'];
                let chartData = [
                    totals.dcCollected,
                    totals.storeCollected,
                    totals.dcMoved,
                    totals.placed,
                    totals.weightPlacement,
                    totals.packingOrder
                ];
                let chartColors = [
                    '#3b82f6', // Blue (DC)
                    '#10b981', // Emerald (Store)
                    '#f59e0b', // Amber (Moved)
                    '#8b5cf6', // Violet (Placed)
                    '#ef4444', // Red (Weight)
                    '#06b6d4'  // Cyan (Packing)
                ];

                if (hasOther) {
                    chartLabels.push('–ê—Ä—Ö—ñ–≤–Ω—ñ –¥–∞–Ω—ñ');
                    chartData.push(totals.other);
                    chartColors.push('#94a3b8'); // Slate 400 (Gray)
                }

                // Check if chart exists
                if (this.distributionChart) {
                    // Update existing chart
                    this.distributionChart.data.labels = chartLabels;
                    this.distributionChart.data.datasets[0].data = chartData;
                    this.distributionChart.data.datasets[0].backgroundColor = chartColors;
                    this.distributionChart.update();
                } else {
                    // Create new chart
                    const canvas = document.getElementById('distributionChart');
                    if (!canvas) return;

                    const ctx = canvas.getContext('2d');
                    this.distributionChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: chartLabels,
                            datasets: [{
                                data: chartData,
                                backgroundColor: chartColors,
                                borderWidth: 0,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        color: '#94a3b8',
                                        font: {
                                            family: "'Outfit', sans-serif",
                                            size: 11
                                        },
                                        usePointStyle: true,
                                        padding: 15
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function (context) {
                                            const label = context.label || '';
                                            const value = context.raw || 0;
                                            const total = context.chart._metasets[context.datasetIndex].total;
                                            const percentage = Math.round((value / total) * 100) + '%';
                                            return `${label}: ${value.toFixed(2)} (${percentage})`;
                                        }
                                    }
                                }
                            },
                            cutout: '70%'
                        }
                    });
                }
            } // End of updateDistributionChart


            setAutoRange() {
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                const dates = Object.keys(savedData).sort();

                if (dates.length > 0) {
                    this.dateFrom.value = dates[0];
                    this.dateTo.value = dates[dates.length - 1];
                    this.updateStatistics();

                    [this.dateFrom, this.dateTo].forEach(input => {
                        input.style.transform = 'scale(1.05)';
                        input.style.borderColor = '#3b82f6';
                        setTimeout(() => {
                            input.style.transform = '';
                            input.style.borderColor = '';
                        }, 300);
                    });
                }
            };

            showManualModal() {
                const now = new Date();
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                document.getElementById('manual-date').value = `${year}-${month}-${day}`;

                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ —Ç–∞ —Ç–æ—á–Ω–æ—Å—Ç—ñ
                document.getElementById('manual-rating').value = '4.0';
                document.getElementById('manual-accuracy').value = '95';

                this.manualModal.classList.remove('hidden');
            };

            hideManualModal() {
                this.manualModal.classList.add('hidden');
                document.getElementById('manual-dc-collected').value = '';
                document.getElementById('manual-store-collected').value = '';
                document.getElementById('manual-dc-moved').value = '';
                document.getElementById('manual-placed').value = '';
                document.getElementById('manual-weight-placement').value = ''; // –ù–û–í–ò–ô
                document.getElementById('manual-packing-order').value = ''; // –ù–û–í–ò–ô
                document.getElementById('manual-work-time-start').value = '';
                document.getElementById('manual-work-time-end').value = '';
                document.getElementById('manual-work-time-total').textContent = '0 –≥–æ–¥ 0 —Ö–≤';
                document.getElementById('manual-rating').value = '4.0';
                document.getElementById('manual-accuracy').value = '95';
            };

            showClearModal() {
                this.clearModal.classList.remove('hidden');
            };

            hideClearModal() {
                this.clearModal.classList.add('hidden');
            };

            clearMonth(saveToArchive) {
                const currentMonth = new Date().toISOString().slice(0, 7);
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');

                const currentMonthData = {};
                const remainingData = {};

                Object.keys(savedData).forEach(date => {
                    if (date.startsWith(currentMonth)) {
                        currentMonthData[date] = savedData[date];
                    } else {
                        remainingData[date] = savedData[date];
                    }
                });

                if (saveToArchive && Object.keys(currentMonthData).length > 0) {
                    let monthlyArchives = JSON.parse(localStorage.getItem('monthlyArchives') || '{}');
                    const dates = Object.keys(currentMonthData).sort();
                    const firstDate = dates[0];
                    const lastDate = dates[dates.length - 1];
                    const total = Object.values(currentMonthData).reduce((sum, item) => sum + (item.totalWithBonuses || item.total || 0), 0);

                    monthlyArchives[currentMonth] = {
                        period: `${firstDate} - ${lastDate}`,
                        data: currentMonthData,
                        total: total,
                        daysCount: dates.length
                    };

                    localStorage.setItem('monthlyArchives', JSON.stringify(monthlyArchives));
                }

                localStorage.setItem('warehouseData', JSON.stringify(remainingData));

                [this.dcCollectedInput, this.storeCollectedInput, this.dcMovedInput,
                this.placedInput, this.weightPlacementInput, this.packingOrderInput].forEach(input => {
                    if (input) {
                        input.style.transform = 'scale(0.9)';
                        input.value = '';
                        setTimeout(() => {
                            input.style.transform = '';
                        }, 200);
                    }
                });

                this.hideClearModal();
                this.updateCalculations();
                this.updateStatistics();
                this.loadMonthlyArchives();
                this.updateChart([]);
                this.updateDistributionChart([]); // Clear distribution chart

                this.showSuccessAnimation();
            };

            loadMonthlyArchives() {
                try {
                    const container = document.getElementById('monthly-archives');
                    if (!container) return;

                    container.innerHTML = '';

                    let monthlyArchives = {};
                    try {
                        const archivesData = localStorage.getItem('monthlyArchives');

                        if (archivesData) {
                            monthlyArchives = JSON.parse(archivesData);
                        } else {
                            container.innerHTML = '<div class="text-blue-300 text-center py-4 italic">–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∞—Ä—Ö—ñ–≤—ñ–≤</div>';
                            return;
                        }
                    } catch (error) {
                        console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö –∞—Ä—Ö—ñ–≤—É:", error);
                        container.innerHTML = '<div class="text-red-300 text-center py-4 italic">–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∞—Ä—Ö—ñ–≤—ñ–≤</div>';
                        return;
                    }

                    const currentMonth = new Date().toISOString().slice(0, 7);
                    const currentMonthArchives = {};

                    Object.keys(monthlyArchives).forEach(key => {
                        if (key.startsWith(currentMonth) ||
                            ((key.includes('-first') || key.includes('-second')) && key.startsWith(currentMonth.slice(0, 7)))) {
                            currentMonthArchives[key] = monthlyArchives[key];
                        }
                    });

                    const archiveKeys = Object.keys(currentMonthArchives);

                    if (archiveKeys.length === 0) {
                        container.innerHTML = '<div class="text-blue-300 text-center py-4 italic">–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∞—Ä—Ö—ñ–≤—ñ–≤ –∑–∞ –ø–æ—Ç–æ—á–Ω–∏–π –º—ñ—Å—è—Ü—å</div>';
                        return;
                    }

                    archiveKeys.sort().reverse().forEach((archiveKey, index) => {
                        try {
                            const archive = currentMonthArchives[archiveKey];

                            if (!archive || typeof archive !== 'object') {
                                return;
                            }

                            const div = document.createElement('div');
                            div.className = 'archive-item bg-white bg-opacity-10 rounded-xl p-4 cursor-pointer transition-all duration-300 hover:bg-opacity-20';
                            div.style.animationDelay = `${index * 0.1}s`;

                            let formattedTotal = "0.00";

                            if (typeof archive.total !== 'undefined') {
                                if (Math.abs(archive.total) > 999999) {
                                    formattedTotal = archive.total.toExponential(2);
                                } else {
                                    formattedTotal = archive.total.toFixed(2);
                                }
                            }

                            let archiveTitle = '';
                            let periodText = archive.period || '';
                            let daysCount = archive.daysCount || '0';

                            if (archive.halfType && archive.monthName) {
                                archiveTitle = `${archive.halfType} ${archive.monthName}`;
                            } else {
                                const [year, month] = archiveKey.split('-');
                                if (year && month) {
                                    const monthNames = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å', '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];
                                    const monthIndex = parseInt(month) - 1;
                                    if (monthIndex >= 0 && monthIndex < 12) {
                                        archiveTitle = `${monthNames[monthIndex]} ${year}`;
                                    } else {
                                        archiveTitle = archiveKey;
                                    }
                                } else {
                                    archiveTitle = archiveKey;
                                }
                            }

                            div.innerHTML = `
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="text-white font-bold text-lg flex items-center">
                                            <i class="fas fa-calendar-check mr-2 text-blue-400"></i>
                                            ${archiveTitle}
                                        </div>
                                        <div class="text-blue-300 text-sm mt-1">${periodText}</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-green-400 font-bold text-xl">${formattedTotal}</div>
                                        <div class="text-blue-300 text-sm">${daysCount} –¥–Ω—ñ–≤</div>
                                    </div>
                                </div>
                            `;

                            div.addEventListener('click', () => {
                                let original_month = archiveKey;
                                if (archiveKey.includes('-first') || archiveKey.includes('-second')) {
                                    original_month = archiveKey.split('-').slice(0, 2).join('-');
                                }

                                window.location.href = `archive-detail.html?month=${original_month}&archive_key=${archiveKey}`;
                            });

                            container.appendChild(div);
                        } catch (error) {
                            console.error(`–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ –∞—Ä—Ö—ñ–≤—É ${archiveKey}:`, error);
                        }
                    });
                } catch (error) {
                    console.error("–ó–∞–≥–∞–ª—å–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –≤ loadMonthlyArchives():", error);
                    const container = document.getElementById('monthly-archives');
                    if (container) {
                        container.innerHTML = '<div class="text-red-300 text-center py-4 italic">–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∞—Ä—Ö—ñ–≤—ñ–≤</div>';
                    }
                }
            };

            showSuccessMessage(message) {
                const successMessage = document.createElement('div');
                successMessage.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                successMessage.innerHTML = `<i class="fas fa-check mr-2"></i>${message}`;
                successMessage.style.animation = 'slideInRight 0.3s ease-out';

                document.body.appendChild(successMessage);

                setTimeout(() => {
                    successMessage.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => successMessage.remove(), 300);
                }, 3000);
            };

            saveToArchive() {
                const currentMonth = new Date().toISOString().slice(0, 7);
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');

                const currentMonthData = {};

                Object.keys(savedData).forEach(date => {
                    if (date.startsWith(currentMonth)) {
                        currentMonthData[date] = savedData[date];
                    }
                });

                if (Object.keys(currentMonthData).length === 0) {
                    this.showErrorMessage('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –∞—Ä—Ö—ñ–≤');
                    return;
                }

                const [year, monthNum] = currentMonth.split('-');
                const monthNames = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å', '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];
                const monthName = monthNames[parseInt(monthNum) - 1];

                // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –±–µ–∑ –≤–∏–±–æ—Ä—É –ø–æ–ª–æ–≤–∏–Ω–∏ –º—ñ—Å—è—Ü—è
                let monthlyArchives = JSON.parse(localStorage.getItem('monthlyArchives') || '{}');
                const dates = Object.keys(currentMonthData).sort();
                const firstDate = dates[0];
                const lastDate = dates[dates.length - 1];
                const total = Object.values(currentMonthData).reduce((sum, item) => sum + (item.totalWithBonuses || item.total || 0), 0);

                monthlyArchives[currentMonth] = {
                    period: `${firstDate} - ${lastDate}`,
                    data: currentMonthData,
                    total: total,
                    daysCount: dates.length
                };

                localStorage.setItem('monthlyArchives', JSON.stringify(monthlyArchives));
                this.loadMonthlyArchives();
                this.showSuccessAnimation();
            };

            updateWorkTimeTotal() {
                const workTimeStart = document.getElementById('work-time-start').value;
                const workTimeEnd = document.getElementById('work-time-end').value;
                const workTimeTotal = document.getElementById('work-time-total');

                if (workTimeStart && workTimeEnd) {
                    const startParts = workTimeStart.split(':');
                    const endParts = workTimeEnd.split(':');

                    const startDate = new Date();
                    startDate.setHours(parseInt(startParts[0]), parseInt(startParts[1]), 0);

                    const endDate = new Date();
                    endDate.setHours(parseInt(endParts[0]), parseInt(endParts[1]), 0);

                    if (endDate < startDate) {
                        endDate.setDate(endDate.getDate() + 1);
                    }

                    const diffMinutes = Math.floor((endDate - startDate) / (1000 * 60));
                    const hours = Math.floor(diffMinutes / 60);
                    const minutes = diffMinutes % 60;

                    workTimeTotal.textContent = `${hours} –≥–æ–¥ ${minutes} —Ö–≤`;
                } else {
                    workTimeTotal.textContent = '0 –≥–æ–¥ 0 —Ö–≤';
                }
            };

            updateManualWorkTimeTotal() {
                const workTimeStart = document.getElementById('manual-work-time-start').value;
                const workTimeEnd = document.getElementById('manual-work-time-end').value;
                const workTimeTotal = document.getElementById('manual-work-time-total');

                if (workTimeStart && workTimeEnd) {
                    const startParts = workTimeStart.split(':');
                    const endParts = workTimeEnd.split(':');

                    const startDate = new Date();
                    startDate.setHours(parseInt(startParts[0]), parseInt(startParts[1]), 0);

                    const endDate = new Date();
                    endDate.setHours(parseInt(endParts[0]), parseInt(endParts[1]), 0);

                    if (endDate < startDate) {
                        endDate.setDate(endDate.getDate() + 1);
                    }

                    const diffMinutes = Math.floor((endDate - startDate) / (1000 * 60));
                    const hours = Math.floor(diffMinutes / 60);
                    const minutes = diffMinutes % 60;

                    workTimeTotal.textContent = `${hours} –≥–æ–¥ ${minutes} —Ö–≤`;
                } else {
                    workTimeTotal.textContent = '0 –≥–æ–¥ 0 —Ö–≤';
                }
            };

            validateTimeInput(input) {
                if (!input.value) return;

                const timeParts = input.value.split(':');
                if (timeParts.length !== 2) return;

                let hours = parseInt(timeParts[0]);
                let minutes = parseInt(timeParts[1]);

                if (hours > 23) hours = 23;
                if (minutes > 59) minutes = 59;

                const formattedHours = hours.toString().padStart(2, '0');
                const formattedMinutes = minutes.toString().padStart(2, '0');

                input.value = `${formattedHours}:${formattedMinutes}`;
            };

            confirmDeleteAllArchives() {
                const modalId = 'delete-all-archives-confirmation-modal';
                let modal = document.getElementById(modalId);
                if (modal) modal.remove();

                modal = document.createElement('div');
                modal.id = modalId;
                modal.className = 'fixed inset-0 modal-backdrop flex items-center justify-center p-4 z-50';
                modal.innerHTML = `
                    <div class="glass-effect rounded-2xl p-8 w-full max-w-md modal-content">
                        <h3 class="text-2xl font-bold text-white mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle mr-3 text-red-400"></i>
                            –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –∞—Ä—Ö—ñ–≤–∏?
                        </h3>
                        <p class="text-blue-200 mb-8 text-lg">–í–∏ –¥—ñ–π—Å–Ω–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –í–°–Ü –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∞—Ä—Ö—ñ–≤–∏? –¶—è –¥—ñ—è –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω–∞.</p>
                        <div class="grid grid-cols-2 gap-4">
                            <button id="cancel-delete-all-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                                –°–∫–∞—Å—É–≤–∞—Ç–∏
                            </button>
                            <button id="confirm-delete-all-btn" class="btn-primary btn-danger text-white font-bold py-3 px-4 rounded-lg relative overflow-hidden">
                                <i class="fas fa-trash-alt mr-2"></i>
                                –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                document.getElementById('cancel-delete-all-btn').addEventListener('click', () => {
                    modal.remove();
                });

                document.getElementById('confirm-delete-all-btn').addEventListener('click', () => {
                    modal.remove();
                    this.deleteAllArchives();
                });
            };

            deleteAllArchives() {
                localStorage.removeItem('monthlyArchives');
                this.loadMonthlyArchives();
                this.showSuccessMessage('–í—Å—ñ –∞—Ä—Ö—ñ–≤–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ!');
            }

            // ========== Data Backup Functions ==========

            exportData() {
                try {
                    // Collect all data from localStorage
                    const warehouseData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                    const monthlyArchives = JSON.parse(localStorage.getItem('monthlyArchives') || '{}');

                    // Create backup object with metadata
                    const backup = {
                        version: '1.0',
                        exportDate: new Date().toISOString(),
                        warehouseData: warehouseData,
                        monthlyArchives: monthlyArchives
                    };

                    // Create filename with timestamp
                    const dateStr = new Date().toISOString().split('T')[0];
                    const filename = `warehouse-stats-backup-${dateStr}.json`;

                    // Create and download JSON file
                    const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    this.showSuccessMessage(`–î–∞–Ω—ñ –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ: ${filename}`);
                } catch (error) {
                    console.error('Export error:', error);
                    this.showErrorMessage('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –µ–∫—Å–ø–æ—Ä—Ç—ñ –¥–∞–Ω–∏—Ö');
                }
            }

            triggerFileImport() {
                // Trigger file picker
                this.importFileInput.click();
            }

            handleFileSelect(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);

                        // Validate structure
                        if (!data.version || !data.warehouseData || !data.monthlyArchives) {
                            throw new Error('Invalid backup file format');
                        }

                        // Store data temporarily and show import modal
                        this.importedData = data;
                        this.showImportModal();
                    } catch (error) {
                        console.error('File read error:', error);
                        this.showErrorMessage('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É. –û—á—ñ–∫—É—î—Ç—å—Å—è JSON —Ñ–∞–π–ª —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó.');
                    }
                };

                reader.readAsText(file);
                // Reset file input
                event.target.value = '';
            }

            importData(merge = false) {
                try {
                    if (!this.importedData) {
                        this.showErrorMessage('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É');
                        return;
                    }

                    if (merge) {
                        // Merge mode: combine imported data with existing
                        const existingWarehouse = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                        const existingArchives = JSON.parse(localStorage.getItem('monthlyArchives') || '{}');

                        const mergedWarehouse = { ...existingWarehouse, ...this.importedData.warehouseData };
                        const mergedArchives = { ...existingArchives, ...this.importedData.monthlyArchives };

                        localStorage.setItem('warehouseData', JSON.stringify(mergedWarehouse));
                        localStorage.setItem('monthlyArchives', JSON.stringify(mergedArchives));

                        this.showSuccessMessage('–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –æ–±\'—î–¥–Ω–∞–Ω–æ!');
                    } else {
                        // Replace mode: clear and import
                        localStorage.setItem('warehouseData', JSON.stringify(this.importedData.warehouseData));
                        localStorage.setItem('monthlyArchives', JSON.stringify(this.importedData.monthlyArchives));

                        this.showSuccessMessage('–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!');
                    }

                    // Reload all data
                    this.loadData();
                    this.updateStatistics();
                    this.loadMonthlyArchives();

                    // Clear temporary data and hide modal
                    this.importedData = null;
                    this.hideImportModal();
                } catch (error) {
                    console.error('Import error:', error);
                    this.showErrorMessage('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ –¥–∞–Ω–∏—Ö');
                }
            }

            showImportModal() {
                this.importModal.classList.remove('hidden');
            }

            hideImportModal() {
                this.importModal.classList.add('hidden');
                this.importedData = null;
            }

            // ========== End Data Backup Functions ==========

            clearInputFields() {
                const inputsToClear = [
                    this.dcCollectedInput,
                    this.storeCollectedInput,
                    this.dcMovedInput,
                    this.placedInput,
                    this.weightPlacementInput, // –ù–û–í–ò–ô
                    this.packingOrderInput, // –ù–û–í–ò–ô
                    document.getElementById('work-time-start'),
                    document.getElementById('work-time-end')
                ];

                inputsToClear.forEach(input => {
                    if (input) {
                        input.value = '';
                        if (input.classList.contains('input-glow')) {
                            input.style.transform = 'scale(0.95)';
                            input.style.opacity = '0.7';
                            setTimeout(() => {
                                input.style.transform = '';
                                input.style.opacity = '';
                            }, 200);
                        }
                    }
                });

                this.updateCalculations();
                this.updateWorkTimeTotal();

                if (this.dcCollectedInput) {
                    this.dcCollectedInput.focus();
                }
            };

            showClearMonthModal() {
                const modal = document.getElementById('clear-modal');
                if (!modal) return;

                this.populateClearMonthSelect();

                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.style.overflow = 'hidden';
            }

            hideClearMonthModal() {
                const modal = document.getElementById('clear-modal');
                if (modal) {
                    modal.classList.add('hidden');
                    document.body.style.overflow = '';
                }
            }

            populateClearMonthSelect() {
                const selectInfo = document.getElementById('clear-month-select');
                if (!selectInfo) return;

                selectInfo.innerHTML = '';

                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                const dates = Object.keys(savedData);

                // Extract unique months
                const months = new Set();
                dates.forEach(date => {
                    // date format is YYYY-MM-DD
                    const monthKey = date.substring(0, 7); // YYYY-MM
                    months.add(monthKey);
                });

                if (months.size === 0) {
                    const option = document.createElement('option');
                    option.text = "–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö";
                    option.disabled = true;
                    selectInfo.add(option);
                    return;
                }

                // Sort months descending (newest first)
                const sortedMonths = Array.from(months).sort().reverse();

                const monthNames = [
                    '–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å',
                    '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'
                ];

                sortedMonths.forEach(monthKey => {
                    const [year, month] = monthKey.split('-');
                    const monthIndex = parseInt(month) - 1;
                    const monthName = monthNames[monthIndex];

                    const option = document.createElement('option');
                    option.value = monthKey;
                    option.text = `${monthName} ${year}`;
                    selectInfo.add(option);
                });
            }

            clearMonthData(shouldArchive) {
                const selectInfo = document.getElementById('clear-month-select');
                if (!selectInfo || !selectInfo.value) {
                    this.showErrorMessage("–ù–µ –≤–∏–±—Ä–∞–Ω–æ –º—ñ—Å—è—Ü—å –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è!");
                    return;
                }

                const selectedMonthKey = selectInfo.value; // YYYY-MM
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');

                // If archiving is requested (shouldArchive=true), we might want to save to monthlyArchives,
                // but for now we follow the existing pattern which was just clear/don't clear logic?
                // The previous code had clearMonth(archive). Let's see if we need to call saveToArchive?
                // The user's request is specific month clearing. 
                // The UI says "–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –∞—Ä—Ö—ñ–≤ —Ç–∞ –æ—á–∏—Å—Ç–∏—Ç–∏" vs "–û—á–∏—Å—Ç–∏—Ç–∏ –±–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è".

                // If save is requested, we should probably save ALL data to archive first? 
                // Or just the month? The current architecture saves ALL data to `monthlyArchives`.
                // Let's call saveToArchive() if `shouldArchive` is true, but `saveToArchive` might expect to archive EVERYTHING.

                if (shouldArchive) {
                    // Check if saveToArchive exists and use it
                    // Actually saveToArchive implementation (not shown) likely saves current month.
                    // For specific month archiving, logic is complex. 
                    // Let's assume for now we just delete, or perhaps we should duplicate the logic of archiving?
                    // Existing `saveToArchive` likely buckets everything by month. 
                    // Let's just run `saveToArchive` if true, which updates the archives, then we delete from warehouseData.
                    this.saveToArchive();
                }

                let dataChanged = false;
                Object.keys(savedData).forEach(date => {
                    if (date.startsWith(selectedMonthKey)) {
                        delete savedData[date];
                        dataChanged = true;
                    }
                });

                if (dataChanged) {
                    localStorage.setItem('warehouseData', JSON.stringify(savedData));
                    this.updateStatistics();
                    this.renderHeatmapCalendar();
                    this.hideClearMonthModal();
                    this.showSuccessMessage(`–î–∞–Ω—ñ –∑–∞ ${selectedMonthKey} —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ!`);
                } else {
                    this.hideClearMonthModal();
                    this.showErrorMessage('–î–∞–Ω–∏—Ö –∑–∞ —Ü–µ–π –º—ñ—Å—è—Ü—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.');
                }
            }

            showExportModal() {
                const modal = document.getElementById('export-modal');
                if (!modal) return;

                this.populateExportMonthSelect();

                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.style.overflow = 'hidden';
            }

            hideExportModal() {
                const modal = document.getElementById('export-modal');
                if (modal) {
                    modal.classList.add('hidden');
                    document.body.style.overflow = '';
                }
            }

            populateExportMonthSelect() {
                const selectInfo = document.getElementById('export-month-select');
                if (!selectInfo) return;

                selectInfo.innerHTML = '';

                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');
                const dates = Object.keys(savedData);

                // Extract unique months
                const months = new Set();
                dates.forEach(date => {
                    const monthKey = date.substring(0, 7); // YYYY-MM
                    months.add(monthKey);
                });

                if (months.size === 0) {
                    const option = document.createElement('option');
                    option.text = "–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö";
                    option.disabled = true;
                    selectInfo.add(option);
                    return;
                }

                const sortedMonths = Array.from(months).sort().reverse();
                const monthNames = [
                    '–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å',
                    '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'
                ];

                sortedMonths.forEach(monthKey => {
                    const [year, month] = monthKey.split('-');
                    const monthIndex = parseInt(month) - 1;
                    const monthName = monthNames[monthIndex];

                    const option = document.createElement('option');
                    option.value = monthKey;
                    option.text = `${monthName} ${year}`;
                    selectInfo.add(option);
                });
            }

            exportMonthData() {
                const selectInfo = document.getElementById('export-month-select');
                if (!selectInfo || !selectInfo.value) {
                    this.showErrorMessage("–ù–µ –≤–∏–±—Ä–∞–Ω–æ –º—ñ—Å—è—Ü—å –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É!");
                    return;
                }

                const selectedMonthKey = selectInfo.value; // YYYY-MM
                const savedData = JSON.parse(localStorage.getItem('warehouseData') || '{}');

                const filteredData = Object.entries(savedData)
                    .filter(([date]) => date.startsWith(selectedMonthKey))
                    .sort((a, b) => a[0].localeCompare(b[0])); // Sort by date ascending

                if (filteredData.length === 0) {
                    this.showErrorMessage("–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –∑–∞ –æ–±—Ä–∞–Ω–∏–π –º—ñ—Å—è—Ü—å.");
                    return;
                }

                // Prepare CSV content
                let csvContent = "–î–∞—Ç–∞;–î–° –ó—ñ–±—Ä–∞–Ω–æ;–¢–ó –ó—ñ–±—Ä–∞–Ω–æ;–î–° –ü–µ—Ä–µ–º—ñ—â–µ–Ω–æ;–†–æ–∑–º—ñ—â–µ–Ω–æ;–í–∞–≥–∞ (–∫–≥);–ü–∞–∫—É–≤–∞–Ω–Ω—è;–¢–æ—á–Ω—ñ—Å—Ç—å;–û—Ü—ñ–Ω–∫–∞;–ß–∞—Å;–ó–∞—Ä–æ–±—ñ—Ç–æ–∫;–ö–æ–º–µ–Ω—Ç–∞—Ä\n";

                filteredData.forEach(([date, data]) => {
                    const formatNumber = (num) => (num || 0).toString().replace('.', ',');

                    // Format time
                    const totalMinutes = data.workTimeTotal || 0;
                    const hours = Math.floor(totalMinutes / 60);
                    const minutes = totalMinutes % 60;
                    const timeString = `${hours} –≥–æ–¥ ${minutes} —Ö–≤`;

                    const row = [
                        date,
                        data.dcCollected || 0,
                        data.storeCollected || 0,
                        data.dcMoved || 0,
                        data.placed || 0,
                        formatNumber(data.weightPlacement),
                        data.packingOrder || 0,
                        data.accuracy || 0, // Accuracy is usually integer 0-100, but just in case
                        formatNumber(data.rating),
                        timeString,
                        formatNumber((data.totalWithBonuses || data.total || 0).toFixed(2)),
                        '' // Placeholder for comments
                    ];
                    csvContent += row.join(";") + "\n";
                });

                // Generate file name
                const [year, month] = selectedMonthKey.split('-');
                const fileName = `Warehouse_Stats_${year}_${month}.csv`;

                // Create download link
                const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", fileName);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                this.hideExportModal();
                this.showSuccessMessage(`–ó–≤—ñ—Ç –∑–∞ ${selectedMonthKey} —É—Å–ø—ñ—à–Ω–æ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ!`);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            try {
                if (typeof Chart === 'undefined') {
                    console.error("Chart.js –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!");
                }

                try {
                    window.warehouseStatsInstance = new WarehouseStats();
                    console.log("–ü—Ä–æ–≥—Ä–∞–º—É —É—Å–ø—ñ—à–Ω–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ");
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ WarehouseStats:", error);

                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'fixed top-0 left-0 right-0 bg-red-600 text-white p-4 text-center';
                    errorMessage.innerHTML = '–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–≥—Ä–∞–º–∏. –ë—É–¥—å –ª–∞—Å–∫–∞, –æ–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É.';
                    document.body.appendChild(errorMessage);
                }

                const head = document.querySelector('head');
                const favicon = document.createElement('link');
                favicon.rel = 'icon';
                favicon.href = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üìä</text></svg>';
                head.appendChild(favicon);
            } catch (error) {
                console.error("–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó:", error);
            }
        });

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/Robota_Personal/sw.js')
                    .then((registration) => {
                        console.log('[PWA] Service Worker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.error('[PWA] Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>
